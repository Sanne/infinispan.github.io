<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="generator" content="Asciidoctor 1.5.4"> <title>Using Hot Rod Server</title> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"> <style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css"> <style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style> </head> <body class="book"> <div id="header"> </div> <div id="content"> <div class="sect2"> <h3 id="_using_hot_rod_server"><a class="anchor" href="#_using_hot_rod_server"></a>1. Using Hot Rod Server</h3> <div class="paragraph"> <p>The Infinispan Server distribution contains a server module that implements Infinispan&#8217;s custom binary protocol called Hot Rod. The protocol was designed to enable faster client/server interactions compared to other existing text based protocols and to allow clients to make more intelligent decisions with regards to load balancing, failover and even data location operations. Please refer to Infinispan Server&#8217;s <a href="../infinispan_server_guide/infinispan_server_guide.html">documentation</a> for instructions on how to configure and run a HotRod server.</p> </div> <div class="sect3"> <h4 id="_hot_rod_protocol"><a class="anchor" href="#_hot_rod_protocol"></a>1.1. Hot Rod Protocol</h4> <div class="paragraph"> <p>The following articles provides detailed information about each version of the custom TCP client/server Hot Rod protocol.</p> </div> <div class="ulist"> <ul> <li> <p><a href="#_hot_rod_protocol_1_0">Hot Rod Protocol 1.0</a></p> </li> <li> <p><a href="#_hot_rod_protocol_1_1">Hot Rod Protocol 1.1</a></p> </li> <li> <p><a href="#_hot_rod_protocol_1_2">Hot Rod Protocol 1.2</a></p> </li> <li> <p><a href="#_hot_rod_protocol_1_3">Hot Rod Protocol 1.3</a></p> </li> <li> <p><a href="#_hot_rod_protocol_2_0">Hot Rod Protocol 2.0</a></p> </li> <li> <p><a href="#_hot_rod_protocol_2_1">Hot Rod Protocol 2.1</a></p> </li> <li> <p><a href="#_hot_rod_protocol_2_2">Hot Rod Protocol 2.2</a></p> </li> <li> <p><a href="#_hot_rod_protocol_2_3">Hot Rod Protocol 2.3</a></p> </li> <li> <p><a href="#_hot_rod_protocol_2_4">Hot Rod Protocol 2.4</a></p> </li> <li> <p><a href="#_hot_rod_protocol_2_5">Hot Rod Protocol 2.5</a></p> </li> </ul> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_1_0"><a class="anchor" href="#_hot_rod_protocol_1_0"></a>Hot Rod Protocol 1.0</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 4.1.0.Final </td> </tr> </table> </div> <div class="admonitionblock important"> <table> <tr> <td class="icon"> <i class="fa icon-important" title="Important"></i> </td> <td class="content"> All key and values are sent and stored as byte arrays. Hot Rod makes no assumptions about their types. </td> </tr> </table> </div> <div class="paragraph"> <p>Some clarifications about the other types:</p> </div> <div class="ulist"> <ul> <li> <p>vInt : Variable-length integers are defined defined as compressed, positive integers where the high-order bit of each byte indicates whether more bytes need to be read. The low-order seven bits are appended as increasingly more significant bits in the resulting integer value making it efficient to decode. Hence, values from zero to 127 are stored in a single byte, values from 128 to 16,383 are stored in two bytes, and so on:</p> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 25%;"> <col style="width: 25%;"> <col style="width: 25%;"> <col style="width: 25%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top"><code>Value</code></th> <th class="tableblock halign-left valign-top"><code>First byte</code></th> <th class="tableblock halign-left valign-top"><code>Second byte</code></th> <th class="tableblock halign-left valign-top"><code>Third byte</code></th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000000</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000001</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000010</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#8230;&#8203;</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>127</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>01111111</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>128</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000000</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000001</code></p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>129</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000001</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000001</code></p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>130</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000010</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000001</code></p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#8230;&#8203;</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>16,383</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>11111111</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>01111111</code></p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>16,384</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000000</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000000</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000001</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>16,385</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000001</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000000</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000001</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>&#8230;&#8203;</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> </li> <li> <p>signed vInt: The vInt above is also able to encode negative values, but will always use the maximum size (5 bytes) no matter how small the endoded value is. In order to have a small payload for negative values too, signed vInts uses ZigZag encoding on top of the vInt encoding. More details <a href="http://developers.google.com/protocol-buffers/docs/encoding#types">here</a></p> </li> <li> <p>vLong : Refers to unsigned variable length long values similar to vInt but applied to longer values. They&#8217;re between 1 and 9 bytes long.</p> </li> <li> <p>String : Strings are always represented using UTF-8 encoding.</p> </li> </ul> </div> <div class="sect5"> <h6 id="_request_header"><a class="anchor" href="#_request_header"></a>Request Header</h6> <div class="paragraph"> <p>The header for a request is composed of:</p> </div> <table class="tableblock frame-all grid-all spread"> <caption class="title">Table 1. Request header</caption> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Magic</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0xA0 = request</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Message ID</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vLong</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">ID of the message that will be copied back in the response. This allows for hot rod clients to implement the protocol in an asynchronous way.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Infinispan hot rod server version. In this particular case, this is 10</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Opcode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request operation code:<br> 0x01 = put (since 1.0)<br> 0x03 = get (since 1.0)<br> 0x05 = putIfAbsent (since 1.0)<br> 0x07 = replace (since 1.0)<br> 0x09 = replaceIfUnmodified (since 1.0)<br> 0x0B = remove (since 1.0)<br> 0x0D = removeIfUnmodified (since 1.0)<br> 0x0F = containsKey (since 1.0)<br> 0x11 = getWithVersion (since 1.0)<br> 0x13 = clear (since 1.0)<br> 0x15 = stats (since 1.0)<br> 0x17 = ping (since 1.0)<br> 0x19 = bulkGet (since 1.2)<br> 0x1B = getWithMetadata (since 1.2)<br> 0x1D = bulkGetKeys (since 1.2)<br> 0x1F = query (since 1.3)<br> 0x21 = authMechList (since 2.0)<br> 0x23 = auth (since 2.0)<br> 0x25 = addClientListener (since 2.0)<br> 0x27 = removeClientListener (since 2.0)<br> 0x29 = size (since 2.0)<br> 0x2B = exec (since 2.1)<br> 0x2D = putAll (since 2.1)<br> 0x2F = getAll (since 2.1)<br> 0x31 = iterationStart (since 2.3)<br> 0x33 = iterationNext (since 2.3)<br> 0x35 = iterationEnd (since 2.3)<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Cache Name Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of cache name. If the passed length is 0 (followed by no cache name), the operation will interact with the default cache.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Cache Name</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Name of cache on which to operate. This name must match the name of predefined cache in the Infinispan configuration file.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Flags</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">A variable length number representing flags passed to the system. Each flags is represented by a bit. Note that since this field is sent as variable length, the most significant bit in a byte is used to determine whether more bytes need to be read, hence this bit does not represent any flag. Using this model allows for flags to be combined in a short space. Here are the current values for each flag:<br> 0x0001 = force return previous value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Client Intelligence</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">This byte hints the server on the client capabilities:<br> 0x01 = basic client, interested in neither cluster nor hash information<br> 0x02 = topology-aware client, interested in cluster information<br> 0x03 = hash-distribution-aware client, that is interested in both cluster and hash information<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Id</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">This field represents the last known view in the client. Basic clients will only send 0 in this field. When topology-aware or hash-distribution-aware clients will send 0 until they have received a reply from the server with the current view id. Afterwards, they should send that view id until they receive a new view id in a response.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Transaction Type</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">This is a 1 byte field, containing one of the following well-known supported transaction types (For this version of the protocol, the only supported transaction type is 0):<br> 0 = Non-transactional call, or client does not support transactions. The subsequent TX_ID field will be omitted.<br> 1 = X/Open XA transaction ID (XID). This is a well-known, fixed-size format.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Transaction Id</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The byte array uniquely identifying the transaction associated to this call. Its length is determined by the transaction type. If transaction type is 0, no transaction id will be present.</p></td> </tr> </tbody> </table> </div> <div class="sect5"> <h6 id="_response_header"><a class="anchor" href="#_response_header"></a>Response Header</h6> <div class="paragraph"> <p>The header for a response is composed of:</p> </div> <table class="tableblock frame-all grid-all spread"> <caption class="title">Table 2. Response header</caption> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Magic</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0xA1 = response</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Message ID</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vLong</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">ID of the message, matching the request for which the response is sent.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Opcode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response operation code:<br> 0x02 = put (since 1.0)<br> 0x04 = get (since 1.0)<br> 0x06 = putIfAbsent (since 1.0)<br> 0x08 = replace (since 1.0)<br> 0x0A = replaceIfUnmodified (since 1.0)<br> 0x0C = remove (since 1.0)<br> 0x0E = removeIfUnmodified (since 1.0)<br> 0x10 = containsKey (since 1.0)<br> 0x12 = getWithVersion (since 1.0)<br> 0x14 = clear (since 1.0)<br> 0x16 = stats (since 1.0)<br> 0x18 = ping (since 1.0)<br> 0x1A = bulkGet (since 1.0)<br> 0x1C = getWithMetadata (since 1.2)<br> 0x1E = bulkGetKeys (since 1.2)<br> 0x20 = query (since 1.3)<br> 0x22 = authMechList (since 2.0)<br> 0x24 = auth (since 2.0)<br> 0x26 = addClientListener (since 2.0)<br> 0x28 = removeClientListener (since 2.0)<br> 0x2A = size (since 2.0)<br> 0x2C = exec (since 2.1)<br> 0x2E = putAll (since 2.1)<br> 0x30 = getAll (since 2.1)<br> 0x32 = iterationStart (since 2.3)<br> 0x34 = iterationNext (since 2.3)<br> 0x36 = iterationEnd (since 2.3)<br> 0x50 = error (since 1.0)<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Status of the response, possible values:<br> 0x00 = No error<br> 0x01 = Not put/removed/replaced<br> 0x02 = Key does not exist<br> 0x81 = Invalid magic or message id<br> 0x82 = Unknown command<br> 0x83 = Unknown version<br> 0x84 = Request parsing error<br> 0x85 = Server Error<br> 0x86 = Command timed out<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Change Marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">This is a marker byte that indicates whether the response is prepended with topology change information. When no topology change follows, the content of this byte is 0. If a topology change follows, its contents are 1.</p></td> </tr> </tbody> </table> <div class="admonitionblock caution"> <table> <tr> <td class="icon"> <i class="fa icon-caution" title="Caution"></i> </td> <td class="content"> Exceptional error status responses, those that start with 0x8 &#8230;&#8203;, are followed by the length of the error message (as a vInt ) and error message itself as String. </td> </tr> </table> </div> </div> <div class="sect5"> <h6 id="_topology_change_headers"><a class="anchor" href="#_topology_change_headers"></a>Topology Change Headers</h6> <div class="paragraph"> <p>The following section discusses how the response headers look for topology-aware or hash-distribution-aware clients when there&#8217;s been a cluster or view formation change. Note that it&#8217;s the server that makes the decision on whether it sends back the new topology based on the current topology id and the one the client sent. If they&#8217;re different, it will send back the new topology.</p> </div> </div> <div class="sect5"> <h6 id="_topology_aware_client_topology_change_header"><a class="anchor" href="#_topology_aware_client_topology_change_header"></a>Topology-Aware Client Topology Change Header</h6> <div class="paragraph"> <p>This is what topology-aware clients receive as response header when a topology change is sent back:</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header with topology change marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">See previous section.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Id</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology ID</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num servers in topology</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of Infinispan Hot Rod servers running within the cluster. This could be a subset of the entire cluster if only a fraction of those nodes are running Hot Rod servers.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of hostname or IP address of individual cluster member that Hot Rod client can use to access it. Using variable length here allows for covering for hostnames, IPv4 and IPv6 addresses.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String containing hostname or IP address of individual cluster member that Hot Rod client can use to access it.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Port that Hot Rod clients can use to communicate with this cluster member.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;etc</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> </div> <div class="sect5"> <h6 id="_distribution_aware_client_topology_change_header"><a class="anchor" href="#_distribution_aware_client_topology_change_header"></a>Distribution-Aware Client Topology Change Header</h6> <div class="paragraph"> <p>This is what hash-distribution-aware clients receive as response header when a topology change is sent back:</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header with topology change marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">See previous section.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Id</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology ID</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num Key Owners</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Globally configured number of copies for each Infinispan distributed key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash Function Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash function version, pointing to a specific hash function in use. See <a href="#_hot_rod_hash_functions">Hot Rod hash functions</a> for details.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash space size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Modulus used by Infinispan for for all module arithmetic related to hash code generation. Clients will likely require this information in order to apply the correct hash calculation to the keys.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num servers in topology</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of Infinispan Hot Rod servers running within the cluster. This could be a subset of the entire cluster if only a fraction of those nodes are running Hot Rod servers.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of hostname or IP address of individual cluster member that Hot Rod client can use to access it. Using variable length here allows for covering for hostnames, IPv4 and IPv6 addresses.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String containing hostname or IP address of individual cluster member that Hot Rod client can use to access it.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Port that Hot Rod clients can use to communicat with this cluster member.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Hashcode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">32 bit integer representing the hashcode of a cluster member that a Hot Rod client can use indentify in which cluster member a key is located having applied the CSA to it.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Hashcode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;etc</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="paragraph"> <p>It&#8217;s important to note that since hash headers rely on the consistent hash algorithm used by the server and this is a factor of the cache interacted with, hash-distribution-aware headers can only be returned to operations that target a particular cache. Currently ping command does not target any cache (this is to change as per <a href="https://jira.jboss.org/jira/browse/ISPN-424">ISPN-424</a>) , hence calls to ping command with hash-topology-aware client settings will return a hash-distribution-aware header with "Num Key Owners", "Hash Function Version", "Hash space size" and each individual host&#8217;s hash code all set to 0. This type of header will also be returned as response to operations with hash-topology-aware client settings that are targeting caches that are not configured with distribution.</p> </div> </div> <div class="sect5"> <h6 id="_operations"><a class="anchor" href="#_operations"></a>Operations</h6> <div class="paragraph"> <div class="title">Get (0x03)/Remove (0x0B)/ContainsKey (0x0F)/GetWithVersion (0x11)</div> <p>Common request format:</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key. Note that the size of a vint can be up to 5 bytes which in theory can produce bigger numbers than Integer.MAX_VALUE. However, Java cannot create a single array that’s bigger than Integer.MAX_VALUE, hence the protocol is limiting vint array lengths to Integer.MAX_VALUE.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Byte array containing the key whose value is being requested.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Get response (0x04):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if key retrieved<br> 0x02 = if key does not exist<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, the requested value</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Remove response (0x0C):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if key removed<br> 0x02 = if key does not exist<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was removed, the length of the previous value will be returned. If the key does not exist, value length would be 0. If no flag was sent, no value length would be present.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was removed, previous value.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>ContainsKey response (0x10):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if key exists<br> 0x02 = if key does not exist<br></p></td> </tr> </tbody> </table> <div class="paragraph"> <p>GetWithVersion response (0x12):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if key retrieved<br> 0x02 = if key does not exist<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">8 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Unique value of an existing entry&#8217;s modification. The protocol does not mandate that entry_version values are sequential. They just need to be unique per update at the key level.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, the requested value</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">BulkGet</div> <p>Request (0x19):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of Infinispan entries to be returned by the server (entry == key + associated value). Needed to support CacheLoader.load(int). If 0 then all entries are returned (needed for CacheLoader.loadAll()).</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x20):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, data follows<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">More</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">One byte representing whether more entries need to be read from the stream. So, when it&#8217;s set to 1, it means that an entry follows, whereas when it&#8217;s set to 0, it&#8217;s the end of stream and no more entries are left to read. For more information on BulkGet look <a href="http://community.jboss.org/docs/DOC-15592">here</a></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Retrieved key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Retrieved value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">More</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203; etc</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Put (0x01)/PutIfAbsent (0x05)/Replace (0x07)</div> <p>Common request format:</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key. Note that the size of a vint can be up to 5 bytes which in theory can produce bigger numbers than Integer.MAX_VALUE. However, Java cannot create a single array that’s bigger than Integer.MAX_VALUE, hence the protocol is limiting vint array lengths to Integer.MAX_VALUE.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Byte array containing the key whose value is being requested.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that a entry during which the entry is allowed to life. If number of seconds is bigger than 30 days, this number of seconds is treated as UNIX time and so, represents the number of seconds since 1/1/1970. If set to 0, lifespan is unlimited.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Max Idle</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that a entry can be idle before it&#8217;s evicted from the cache. If 0, no max idle time.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte-array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Value to be stored</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Put response (0x02):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if stored<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was put, the length of the previous value will be returned. If the key does not exist, value length would be 0. If no flag was sent, no value length would be present.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was put, previous value.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Replace response (0x08):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if stored<br> 0x01 = if store did not happen because key does not exist<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request, the length of the previous value will be returned. If the key does not exist, value length would be 0. If no flag was sent, no value length would be present.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was replaced, previous value.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>PutIfAbsent response (0x06):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if stored<br> 0x01 = if store did not happen because key was present<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request, the length of the previous value will be returned. If the key does not exist, value length would be 0. If no flag was sent, no value length would be present.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was replaced, previous value.</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">ReplaceIfUnmodified</div> <p>Request (0x09):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key. Note that the size of a vint can be up to 5 bytes which in theory can produce bigger numbers than Integer.MAX_VALUE. However, Java cannot create a single array that’s bigger than Integer.MAX_VALUE, hence the protocol is limiting vint array lengths to Integer.MAX_VALUE.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Byte array containing the key whose value is being requested.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that a entry during which the entry is allowed to life. If number of seconds is bigger than 30 days, this number of seconds is treated as UNIX time and so, represents the number of seconds since 1/1/1970. If set to 0, lifespan is unlimited.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Max Idle</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that a entry can be idle before it&#8217;s evicted from the cache. If 0, no max idle time.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">8 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Use the value returned by GetWithVersion operation.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte-array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Value to be stored</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x0A):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if replaced<br> 0x01 = if replace did not happen because key had been modified<br> 0x02 = if not replaced because if key does not exist</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request, the length of the previous value will be returned. If the key does not exist, value length would be 0. If no flag was sent, no value length would be present.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was replaced, previous value.</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">RemoveIfUnmodified</div> <p>Request (0x0D):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key. Note that the size of a vint can be up to 5 bytes which in theory can produce bigger numbers than Integer.MAX_VALUE. However, Java cannot create a single array that’s bigger than Integer.MAX_VALUE, hence the protocol is limiting vint array lengths to Integer.MAX_VALUE.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Byte array containing the key whose value is being requested.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">8 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Use the value returned by GetWithVersion operation.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x0E):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if removed<br> 0x01 = if remove did not happen because key had been modified<br> 0x02 = if not removed because key does not exist<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request, the length of the previous value will be returned. If the key does not exist, value length would be 0. If no flag was sent, no value length would be present.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was removed, previous value.</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Clear</div> <p>Request (0x13):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x14):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if cleared<br></p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">PutAll</div> <p>Bulk operation to put all key value entries into the cache at the same time.</p> </div> <div class="paragraph"> <p>Request (0x2D):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that provided entries are allowed to live. If number of seconds is bigger than 30 days, this number of seconds is treated as UNIX time and so, represents the number of seconds since 1/1/1970. If set to 0, lifespan is unlimited.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Max Idle</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that each entry can be idle before it&#8217;s evicted from the cache. If 0, no max idle time.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">How many entries are being inserted</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Retrieved key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Retrieved value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203; continues until entry count is reached</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x2E):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if all put<br></p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">GetAll</div> <p>Bulk operation to get all entries that map to a given set of keys.</p> </div> <div class="paragraph"> <p>Request (0x2F):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">How many keys to find entries for</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Retrieved key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203; continues until key count is reached</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x30):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">How many entries are being returned</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Retrieved key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Retrieved value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203; continues until entry count is reached</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if the get returned sucessfully<br></p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Stats</div> <p>Returns a summary of all available statistics. For each statistic returned, a name and a value is returned both in String UTF-8 format. The supported stats are the following:</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 50%;"> <col style="width: 50%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Explanation</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">timeSinceStart</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds since Hot Rod started.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">currentNumberOfEntries</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of entries currently in the Hot Rod server.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">totalNumberOfEntries</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of entries stored in Hot Rod server.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">stores</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of put operations.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">retrievals</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of get operations.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">hits</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of get hits.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">misses</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of get misses.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">removeHits</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of removal hits.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">removeMisses</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of removal misses.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Request (0x15):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x16):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if stats retrieved<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of stats</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of individual stats returned.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Name 1 length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of named statistic.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Name 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String containing statistic name.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1 length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of value field.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String containing statistic value.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Name 2 length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Name 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2 length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">String</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;etc</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Ping</div> <p>Application level request to see if the server is available.</p> </div> <div class="paragraph"> <p>Request (0x17):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x18):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if no errors<br></p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Error Handling</div> <p>Error response (0x50)</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x8x = error response code<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Error Message Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of error message</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Error Message</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Error message. In the case of 0x84 , this error field contains the latest version supported by the hot rod server. Length is defined by total body length.</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Multi-Get Operations</div> <p>A multi-get operation is a form of get operation that instead of requesting a single key, requests a set of keys. The Hot Rod protocol does not include such operation but remote Hot Rod clients could easily implement this type of operations by either parallelizing/pipelining individual get requests. Another possibility would be for remote clients to use async or non-blocking get requests. For example, if a client wants N keys, it could send send N async get requests and then wait for all the replies. Finally, multi-get is not to be confused with bulk-get operations. In bulk-gets, either all or a number of keys are retrieved, but the client does not know which keys to retrieve, whereas in multi-get, the client defines which keys to retrieve.</p> </div> </div> <div class="sect5"> <h6 id="_example_put_request"><a class="anchor" href="#_example_put_request"></a>Example - Put request</h6> <div class="ulist"> <ul> <li> <p>Coded request</p> </li> </ul> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1112%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Byte</th> <th class="tableblock halign-left valign-top">0</th> <th class="tableblock halign-left valign-top">1</th> <th class="tableblock halign-left valign-top">2</th> <th class="tableblock halign-left valign-top">3</th> <th class="tableblock halign-left valign-top">4</th> <th class="tableblock halign-left valign-top">5</th> <th class="tableblock halign-left valign-top">6</th> <th class="tableblock halign-left valign-top">7</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0xA0</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x09</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x41</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x07</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x4D ('M')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x79 ('y')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x43 ('C')</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x61 ('a')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x63 ('c')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x68 ('h')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x65 ('e')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x48 ('H')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x65 ('e')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x6C ('l')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x6C ('l')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x6F ('o')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x57 ('W')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x6F ('o')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x72 ('r')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x6C ('l')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x64 ('d')</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td> </tr> </tbody> </table> <div class="ulist"> <ul> <li> <p>Field explanation</p> </li> </ul> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 25%;"> <col style="width: 25%;"> <col style="width: 25%;"> <col style="width: 25%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-left valign-top">Value</th> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Magic (0)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0xA0</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Message Id (1)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x09</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Version (2)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x41</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Opcode (3)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Cache name length (4)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x07</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Cache name(5-11)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">'MyCache'</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Flag (12)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Client Intelligence (13)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Id (14)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Transaction Type (15)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Transaction Id (16)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Key field length (17)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key (18 - 22)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">'Hello'</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan (23)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Max idle (24)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Value field length (25)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value (26-30)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">'World'</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="ulist"> <ul> <li> <p>Coded response</p> </li> </ul> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1111%;"> <col style="width: 11.1112%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Byte</th> <th class="tableblock halign-left valign-top">0</th> <th class="tableblock halign-left valign-top">1</th> <th class="tableblock halign-left valign-top">2</th> <th class="tableblock halign-left valign-top">3</th> <th class="tableblock halign-left valign-top">4</th> <th class="tableblock halign-left valign-top">5</th> <th class="tableblock halign-left valign-top">6</th> <th class="tableblock halign-left valign-top">7</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0xA1</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x09</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td> </tr> </tbody> </table> <div class="ulist"> <ul> <li> <p>Field Explanation</p> </li> </ul> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 25%;"> <col style="width: 25%;"> <col style="width: 25%;"> <col style="width: 25%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-left valign-top">Value</th> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Magic (0)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0xA1</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Message Id (1)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x09</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Opcode (2)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Status (3)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology change marker (4)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> </div> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_1_1"><a class="anchor" href="#_hot_rod_protocol_1_1"></a>Hot Rod Protocol 1.1</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 5.1.0.FINAL </td> </tr> </table> </div> <div class="sect5"> <h6 id="_request_header_2"><a class="anchor" href="#_request_header_2"></a>Request Header</h6> <div class="paragraph"> <p>The <code>version</code> field in the header is updated to <code>11</code>.</p> </div> </div> </div> <div class="sect4"> <h5 id="_distribution_aware_client_topology_change_header_2"><a class="anchor" href="#_distribution_aware_client_topology_change_header_2"></a>Distribution-Aware Client Topology Change Header</h5> <div class="admonitionblock important"> <table> <tr> <td class="icon"> <i class="fa icon-important" title="Important"></i> </td> <td class="content"> <div class="title">Updated for 1.1</div> This section has been modified to be more efficient when talking to distributed caches with virtual nodes enabled. </td> </tr> </table> </div> <div class="paragraph"> <p>This is what hash-distribution-aware clients receive as response header when a topology change is sent back:</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header with topology change marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">See previous section.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Id</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology ID</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num Key Owners</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Globally configured number of copies for each Infinispan distributed key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash Function Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash function version, pointing to a specific hash function in use. See <a href="#_hot_rod_hash_functions">Hot Rod hash functions</a> for details.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash space size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Modulus used by Infinispan for for all module arithmetic related to hash code generation. Clients will likely require this information in order to apply the correct hash calculation to the keys.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num servers in topology</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of Infinispan Hot Rod servers running within the cluster. This could be a subset of the entire cluster if only a fraction of those nodes are running Hot Rod servers.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num Virtual Nodes Owners</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Field added in version 1.1 of the protocol that represents the number of configured virtual nodes. If no virtual nodes are configured or the cache is not configured with distribution, this field will contain 0.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of hostname or IP address of individual cluster member that Hot Rod client can use to access it. Using variable length here allows for covering for hostnames, IPv4 and IPv6 addresses.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String containing hostname or IP address of individual cluster member that Hot Rod client can use to access it.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Port that Hot Rod clients can use to communicat with this cluster member.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Hashcode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">32 bit integer representing the hashcode of a cluster member that a Hot Rod client can use indentify in which cluster member a key is located having applied the CSA to it.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Hashcode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;etc</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> </div> <div class="sect4"> <h5 id="_server_node_hash_code_calculation"><a class="anchor" href="#_server_node_hash_code_calculation"></a>Server node hash code calculation</h5> <div class="paragraph"> <p>Adding support for virtual nodes has made version 1.0 of the Hot Rod protocol impractical due to bandwidth it would have taken to return hash codes for all virtual nodes in the clusters (this number could easily be in the millions). So, as of version 1.1 of the Hot Rod protocol, clients are given the base hash id or hash code of each server, and then they have to calculate the real hash position of each server both with and without virtual nodes configured. Here are the rules clients should follow when trying to calculate a node&#8217;s hash code:</p> </div> <div class="paragraph"> <p>1. With <em>virtual nodes disabled</em> : Once clients have received the base hash code of the server, they need to normalize it in order to find the exact position of the hash wheel. The process of normalization involves passing the base hash code to the hash function, and then do a small calculation to avoid negative values. The resulting number is the node&#8217;s position in the hash wheel:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">int</span> getNormalizedHash(<span class="type">int</span> nodeBaseHashCode, Hash hashFct) {
   <span class="keyword">return</span> hashFct.hash(nodeBaseHashCode) &amp; <span class="predefined-type">Integer</span>.MAX_VALUE; <span class="comment">// make sure no negative numbers are involved.</span>
}</code></pre> </div> </div> <div class="paragraph"> <p>2. With <em>virtual nodes enabled</em> : In this case, each node represents N different virtual nodes, and to calculate each virtual node&#8217;s hash code, we need to take the the range of numbers between 0 and N-1 and apply the following logic:</p> </div> <div class="ulist"> <ul> <li> <p>For virtual node with 0 as id, use the technique used to retrieve a node&#8217;s hash code, as shown in the previous section.</p> </li> <li> <p>For virtual nodes from 1 to N-1 ids, execute the following logic:</p> </li> </ul> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">int</span> virtualNodeHashCode(<span class="type">int</span> nodeBaseHashCode, <span class="type">int</span> id, Hash hashFct) {
   <span class="type">int</span> virtualNodeBaseHashCode = id;
   virtualNodeBaseHashCode = <span class="integer">31</span> * virtualNodeBaseHashCode + nodeBaseHashCode;
   <span class="keyword">return</span> getNormalizedHash(virtualNodeBaseHashCode, hashFct);
}</code></pre> </div> </div> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_1_2"><a class="anchor" href="#_hot_rod_protocol_1_2"></a>Hot Rod Protocol 1.2</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 5.2.0.Final. Since Infinispan 5.3.0, HotRod supports encryption via SSL. However, since this only affects the transport, the version number of the protocol has not been incremented. </td> </tr> </table> </div> <div class="sect5"> <h6 id="_request_header_3"><a class="anchor" href="#_request_header_3"></a>Request Header</h6> <div class="paragraph"> <p>The <code>version</code> field in the header is updated to <code>12</code>.</p> </div> <div class="paragraph"> <p>Two new request operation codes have been added:</p> </div> <div class="ulist"> <ul> <li> <p>0x1B = getWithMetadata request</p> </li> <li> <p>0x1D = bulkKeysGet request</p> </li> </ul> </div> <div class="paragraph"> <p>Two new flags have been added too:</p> </div> <div class="ulist"> <ul> <li> <p>0x0002 = use cache-level configured default lifespan</p> </li> <li> <p>0x0004 = use cache-level configured default max idle</p> </li> </ul> </div> </div> <div class="sect5"> <h6 id="_response_header_2"><a class="anchor" href="#_response_header_2"></a>Response Header</h6> <div class="paragraph"> <p>Two new response operation codes have been added:</p> </div> <div class="ulist"> <ul> <li> <p>0x1C = getWithMetadata response</p> </li> <li> <p>0x1E = bulkKeysGet response</p> </li> </ul> </div> </div> <div class="sect5"> <h6 id="_operations_2"><a class="anchor" href="#_operations_2"></a>Operations</h6> <div class="paragraph"> <div class="title">GetWithMetadata</div> <p>Request (0x1B):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key. Note that the size of a vint can be up to 5 bytes which in theory can produce bigger numbers than Integer.MAX_VALUE. However, Java cannot create a single array that’s bigger than Integer.MAX_VALUE, hence the protocol is limiting vint array lengths to Integer.MAX_VALUE.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Byte array containing the key whose value is being requested.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x1C):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if key retrieved<br> 0x02 = if key does not exist<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Flag</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">A flag indicating whether the response contains expiration information. The value of the flag is obtained as a bitwise OR operation between INFINITE_LIFESPAN (0x01) and <code>INFINITE_MAXIDLE (0x02)</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Created</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Long</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(optional) a Long representing the timestamp when the entry was created on the server. This value is returned only if the flag&#8217;s INFINITE_LIFESPAN bit is not set.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(optional) a vInt representing the lifespan of the entry in seconds. This value is returned only if the flag&#8217;s INFINITE_LIFESPAN bit is not set.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">LastUsed</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Long</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(optional) a Long representing the timestamp when the entry was last accessed on the server. This value is returned only if the flag&#8217;s <code>INFINITE_MAXIDLE</code> bit is not set.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">MaxIdle</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(optional) a vInt representing the maxIdle of the entry in seconds. This value is returned only if the flag&#8217;s <code>INFINITE_MAXIDLE</code> bit is not set.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">8 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Unique value of an existing entry&#8217;s modification. The protocol does not mandate that entry_version values are sequential. They just need to be unique per update at the key level.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, the requested value</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">BulkKeysGet</div> <p>Request (0x1D):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0 = Default Scope - This scope is used by RemoteCache.keySet() method. If the remote cache is a distributed cache, the server launch a stream operation to retrieve all keys from all of the nodes. (Remember, a topology-aware Hot Rod Client could be load balancing the request to any one node in the cluster). Otherwise, it&#8217;ll get keys from the cache instance local to the server receiving the request (that is because the keys should be the same across all nodes in a replicated cache).<br> 1 = Global Scope - This scope behaves the same to Default Scope.<br> 2 = Local Scope - In case when remote cache is a distributed cache, the server will not launch a stream operation to retrieve keys from all nodes. Instead, it&#8217;ll only get keys local from the cache instance local to the server receiving the request.<br></p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x1E):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, data follows<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">More</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">One byte representing whether more keys need to be read from the stream. So, when it&#8217;s set to 1, it means that an entry follows, whereas when it&#8217;s set to 0, it&#8217;s the end of stream and no more entries are left to read. For more information on BulkGet look <a href="http://community.jboss.org/docs/DOC-15592">here</a></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Retrieved key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">More</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203; etc</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> </div> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_1_3"><a class="anchor" href="#_hot_rod_protocol_1_3"></a>Hot Rod Protocol 1.3</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 6.0.0.Final. </td> </tr> </table> </div> <div class="sect5"> <h6 id="_request_header_4"><a class="anchor" href="#_request_header_4"></a>Request Header</h6> <div class="paragraph"> <p>The <code>version</code> field in the header is updated to <code>13</code>.</p> </div> <div class="paragraph"> <p>A new request operation code has been added:</p> </div> <div class="ulist"> <ul> <li> <p>0x1F = query request</p> </li> </ul> </div> </div> <div class="sect5"> <h6 id="_response_header_3"><a class="anchor" href="#_response_header_3"></a>Response Header</h6> <div class="paragraph"> <p>A new response operation code has been added:</p> </div> <div class="ulist"> <ul> <li> <p>0x20 = query response</p> </li> </ul> </div> </div> <div class="sect5"> <h6 id="_operations_3"><a class="anchor" href="#_operations_3"></a>Operations</h6> <div class="paragraph"> <div class="title">Query</div> <p>Request (0x1F):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Query Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The length of the protobuf encoded query object</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Query</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Byte array containing the protobuf encoded query object, having a length specified by previous field.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x20):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response payload Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The length of the protobuf encoded response object</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response payload</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Byte array containing the protobuf encoded response object, having a length specified by previous field.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>As of Infinispan 6.0, the query and response objects are specified by the protobuf message types 'org.infinispan.client.hotrod.impl.query.QueryRequest' and 'org.infinispan.client.hotrod.impl.query.QueryResponse' defined in <a href="https://github.com/infinispan/infinispan/blob/master/remote-query/remote-query-client/src/main/resources/org/infinispan/query/remote/client/query.proto">remote-query/remote-query-client/src/main/resources/org/infinispan/query/remote/client/query.proto</a>. These definitions could change in future Infinispan versions, but as long as these evolutions will be kept backward compatible (according to the rules defined <a href="https://developers.google.com/protocol-buffers/docs/proto#updating">here</a>) no new Hot Rod protocol version will be introduced to accommodate this.</p> </div> </div> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_2_0"><a class="anchor" href="#_hot_rod_protocol_2_0"></a>Hot Rod Protocol 2.0</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 7.0.0.Final. </td> </tr> </table> </div> <div class="sect5"> <h6 id="_request_header_5"><a class="anchor" href="#_request_header_5"></a>Request Header</h6> <div class="paragraph"> <p>The request header no longer contains <code>Transaction Type</code> and <code>Transaction ID</code> elements since they&#8217;re not in use, and even if they were in use, there are several operations for which they would not make sense, such as <code>ping</code> or <code>stats</code> commands. Once transactions are implemented, the protocol version will be upped, with the necessary changes in the request header.</p> </div> <div class="paragraph"> <p>The <code>version</code> field in the header is updated to <code>20</code>.</p> </div> <div class="paragraph"> <p>Two new flags have been added:</p> </div> <div class="ulist"> <ul> <li> <p>0x0008 = operation skips loading from configured cache loader.</p> </li> <li> <p>0x0010 = operation skips indexing. Only relevant when the query module is enabled for the cache</p> </li> </ul> </div> <div class="paragraph"> <p>The following new request operation codes have been added:</p> </div> <div class="ulist"> <ul> <li> <p>0x21 = auth mech list request</p> </li> <li> <p>0x23 = auth request</p> </li> <li> <p>0x25 = add client remote event listener request</p> </li> <li> <p>0x27 = remove client remote event listener request</p> </li> <li> <p>0x29 = size request</p> </li> </ul> </div> </div> <div class="sect5"> <h6 id="_response_header_4"><a class="anchor" href="#_response_header_4"></a>Response Header</h6> <div class="paragraph"> <p>The following new response operation codes have been added:</p> </div> <div class="ulist"> <ul> <li> <p>0x22 = auth mech list response</p> </li> <li> <p>0x24 = auth mech response</p> </li> <li> <p>0x26 = add client remote event listener response</p> </li> <li> <p>0x28 = remove client remote event listener response</p> </li> <li> <p>0x2A = size response</p> </li> </ul> </div> <div class="paragraph"> <p>Two new error codes have also been added to enable clients more intelligent decisions, particularly when it comes to fail-over logic:</p> </div> <div class="ulist"> <ul> <li> <p>0x87 = Node suspected. When a client receives this error as response, it means that the node that responded had an issue sending an operation to a third node, which was suspected. Generally, requests that return this error should be failed-over to other nodes.</p> </li> <li> <p>0x88 = Illegal lifecycle state. When a client receives this error as response, it means that the server-side cache or cache manager are not available for requests because either stopped, they&#8217;re stopping or similar situation. Generally, requests that return this error should be failed-over to other nodes.</p> </li> </ul> </div> <div class="paragraph"> <p>Some adjustments have been made to the responses for the following commands in order to better handle response decoding without the need to keep track of the information sent. More precisely, the way previous values are parsed has changed so that the status of the command response provides clues on whether the previous value follows or not. More precisely:</p> </div> <div class="ulist"> <ul> <li> <p>Put response returns <code>0x03</code> status code when put was successful and previous value follows.</p> </li> <li> <p>PutIfAbsent response returns <code>0x04</code> status code only when the putIfAbsent operation failed because the key was present and its value follows in the response. If the putIfAbsent worked, there would have not been a previous value, and hence it does not make sense returning anything extra.</p> </li> <li> <p>Replace response returns <code>0x03</code> status code only when replace happened and the previous or replaced value follows in the response. If the replace did not happen, it means that the cache entry was not present, and hence there&#8217;s no previous value that can be returned.</p> </li> <li> <p>ReplaceIfUnmodified returns <code>0x03</code> status code only when replace happened and the previous or replaced value follows in the response.</p> </li> <li> <p>ReplaceIfUnmodified returns <code>0x04</code> status code only when replace did not happen as a result of the key being modified, and the modified value follows in the response.</p> </li> <li> <p>Remove returns <code>0x03</code> status code when the remove happened and the previous or removed value follows in the response. If the remove did not occur as a result of the key not being present, it does not make sense sending any previous value information.</p> </li> <li> <p>RemoveIfUnmodified returns <code>0x03</code> status code only when remove happened and the previous or replaced value follows in the response.</p> </li> <li> <p>RemoveIfUnmodified returns <code>0x04</code> status code only when remove did not happen as a result of the key being modified, and the modified value follows in the response.</p> </li> </ul> </div> </div> </div> <div class="sect4"> <h5 id="_distribution_aware_client_topology_change_header_3"><a class="anchor" href="#_distribution_aware_client_topology_change_header_3"></a>Distribution-Aware Client Topology Change Header</h5> <div class="paragraph"> <p>In Infinispan 5.2, virtual nodes based consistent hashing was abandoned and instead segment based consistent hash was implemented. In order to satisfy the ability for Hot Rod clients to find data as reliably as possible, Infinispan has been transforming the segment based consistent hash to fit Hot Rod 1.x protocol. Starting with version 2.0, a brand new distribution-aware topology change header has been implemented which suppors segment based consistent hashing suitably and provides 100% data location guarantees.</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header with topology change marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Id</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology ID</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num servers in topology</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of Infinispan Hot Rod servers running within the cluster. This could be a subset of the entire cluster if only a fraction of those nodes are running Hot Rod servers.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of hostname or IP address of individual cluster member that Hot Rod client can use to access it. Using variable length here allows for covering for hostnames, IPv4 and IPv6 addresses.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String containing hostname or IP address of individual cluster member that Hot Rod client can use to access it.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Port that Hot Rod clients can use to communicat with this cluster member.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash Function Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash function version, pointing to a specific hash function in use. See <a href="#_hot_rod_hash_functions">Hot Rod hash functions</a> for details.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num segments in topology</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Total number of segments in the topology</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of owners in segment</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">This can be either 0, 1 or 2 owners.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">First owner&#8217;s index</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Given the list of all nodes, the position of this owner in this list. This is only present if number of owners for this segment is 1 or 2.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Second owner&#8217;s index</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Given the list of all nodes, the position of this owner in this list. This is only present if number of owners for this segment is 2.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Given this information, Hot Rod clients should be able to recalculate all the hash segments and be able to find out which nodes are owners for each segment. Even though there could be more than 2 owners per segment, Hot Rod protocol limits the number of owners to send for efficiency reasons.</p> </div> <div class="sect5"> <h6 id="_operations_4"><a class="anchor" href="#_operations_4"></a>Operations</h6> <div class="paragraph"> <div class="title">Auth Mech List</div> <p>Request (0x21):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x22):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Mech count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The number of mechs</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Mech 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String containing the name of the SASL mech in its IANA-registered form (e.g. GSSAPI, CRAM-MD5, etc)</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Mech 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;etc</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="paragraph"> <p>The purpose of this operation is to obtain the list of valid SASL authentication mechs supported by the server. The client will then need to issue an Authenticate request with the preferred mech.</p> </div> <div class="paragraph"> <div class="title">Authenticate</div> <p>Request (0x23):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Mech</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String containing the name of the mech chosen by the client for authentication. Empty on the successive invocations</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of the SASL client response</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response data</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The SASL client response</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x24):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Completed</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0 if further processing is needed, 1 if authentication is complete</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Challenge length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of the SASL server challenge</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Challenge data</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The SASL server challenge</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>The purpose of this operation is to authenticate a client against a server using SASL. The authentication process, depending on the chosen mech, might be a multi-step operation. Once complete the connection becomes authenticated</p> </div> <div class="paragraph"> <div class="title">Add client listener for remote events</div> <p>Request (0x25):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener ID</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener identifier</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Include state</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">When this byte is set to <code>1</code>, cached state is sent back to remote clients when either adding a cache listener for the first time, or when the node where a remote listener is registered changes in a clustered environment. When enabled, state is sent back as cache entry created events to the clients. If set to <code>0</code>, no state is sent back to the client when adding a listener, nor it gets state when the node where the listener is registered changes.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key/value filter factory name</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Optional name of the key/value filter factory to be used with this listener. The factory is used to create key/value filter instances which allow events to be filtered directly in the Hot Rod server, avoiding sending events that the client is not interested in. If no factory is to be used, the length of the string is <code>0</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key/value filter factory parameter count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The key/value filter factory, when creating a filter instance, can take an arbitrary number of parameters, enabling the factory to be used to create different filter instances dynamically. This count field indicates how many parameters will be passed to the factory. If no factory name was provided, this field is not present in the request.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key/value filter factory parameter 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">First key/value filter factory parameter</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key/value filter factory parameter 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Second key/value filter factory parameter</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Converter factory name</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Optional name of the converter factory to be used with this listener. The factory is used to transform the contents of the events sent to clients. By default, when no converter is in use, events are well defined, according to the type of event generated. However, there might be situations where users want to add extra information to the event, or they want to reduce the size of the events. In these cases, a converter can be used to transform the event contents. The given converter factory name produces converter instances to do this job. If no factory is to be used, the length of the string is <code>0</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Converter factory parameter count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The converter factory, when creating a converter instance, can take an arbitrary number of parameters, enabling the factory to be used to create different converter instances dynamically. This count field indicates how many parameters will be passed to the factory. If no factory name was provided, this field is not present in the request.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Converter factory parameter 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">First converter factory parameter</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Converter factory parameter 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Second converter factory parameter</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x26):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Remove client listener for remote events</div> <p>Request (0x27):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener ID</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener identifier</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x28):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Size</div> <p>Request (0x29):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x2A):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Size of the remote cache, which is calculated globally in the clustered set ups, and if present, takes cache store contents into account as well.</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Exec</div> <p>Request (0x2B):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Script</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Name of the script to execute</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Parameter Count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The number of parameters</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Parameter 1 Name</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The name of the first parameter</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Parameter 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The length of the first parameter</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Parameter 1 Value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The value of the first parameter</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x2C):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if execution completed successfully<br> 0x85 = server error<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, length of return value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, the result of the execution</p></td> </tr> </tbody> </table> </div> <div class="sect5"> <h6 id="_remote_events"><a class="anchor" href="#_remote_events"></a>Remote Events</h6> <div class="paragraph"> <p>Starting with Hot Rod 2.0, clients can register listeners for remote events happening in the server. Sending these events commences the moment a client adds a client listener for remote events.</p> </div> <div class="paragraph"> <p>Event Header:</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Magic</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0xA1 = response</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Message ID</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vLong</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">ID of event</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Opcode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Event type:<br> 0x60 = cache entry created event<br> 0x61 = cache entry modified event<br> 0x62 = cache entry removed event<br> 0x50 = error<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Status of the response, possible values:<br> 0x00 = No error<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Change Marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Since events are not associated with a particular incoming topology ID to be able to decide whether a new topology is required to be sent or not, new topologies will never be sent with events. Hence, this marker will always have <code>0</code> value for events.</p></td> </tr> </tbody> </table> <table class="tableblock frame-all grid-all spread"> <caption class="title">Table 3. Cache entry created event</caption> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Event header with <code>0x60</code> operation code</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener ID</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener for which this event is directed</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Custom marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Custom event marker. For created events, this is <code>0</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Command retried</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Marker for events that are result of retried commands. If command is retried, it returns <code>1</code>, otherwise <code>0</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Created key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">long</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Version of the created entry. This version information can be used to make conditional operations on this cache entry.</p></td> </tr> </tbody> </table> <table class="tableblock frame-all grid-all spread"> <caption class="title">Table 4. Cache entry modified event</caption> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Event header with <code>0x61</code> operation code</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener ID</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener for which this event is directed</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Custom marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Custom event marker. For created events, this is <code>0</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Command retried</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Marker for events that are result of retried commands. If command is retried, it returns <code>1</code>, otherwise <code>0</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Modified key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">long</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Version of the modified entry. This version information can be used to make conditional operations on this cache entry.</p></td> </tr> </tbody> </table> <table class="tableblock frame-all grid-all spread"> <caption class="title">Table 5. Cache entry removed event</caption> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Event header with <code>0x62</code> operation code</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener ID</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener for which this event is directed</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Custom marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Custom event marker. For created events, this is <code>0</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Command retried</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Marker for events that are result of retried commands. If command is retried, it returns <code>1</code>, otherwise <code>0</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Removed key</p></td> </tr> </tbody> </table> <table class="tableblock frame-all grid-all spread"> <caption class="title">Table 6. Custom event</caption> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Event header with event specific operation code</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener ID</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener for which this event is directed</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Custom marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Custom event marker. For custom events, this is <code>1</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Event data</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Custom event data, formatted according to the converter implementation logic.</p></td> </tr> </tbody> </table> </div> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_2_1"><a class="anchor" href="#_hot_rod_protocol_2_1"></a>Hot Rod Protocol 2.1</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 7.1.0.Final. </td> </tr> </table> </div> <div class="sect5"> <h6 id="_request_header_6"><a class="anchor" href="#_request_header_6"></a>Request Header</h6> <div class="paragraph"> <p>The <code>version</code> field in the header is updated to <code>21</code>.</p> </div> </div> <div class="sect5"> <h6 id="_operations_5"><a class="anchor" href="#_operations_5"></a>Operations</h6> <div class="paragraph"> <div class="title">Add client listener for remote events</div> <p>An extra byte parameter is added at the end which indicates whether the client prefers client listener to work with raw binary data for filter/converter callbacks. If using raw data, its value is <code>1</code> otherwise <code>0</code>.</p> </div> <div class="paragraph"> <p>Request format:</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener ID</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Include state</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key/value filter factory parameter count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Converter factory name</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Converter factory parameter count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Use raw data</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If filter/converter parameters should be raw binary, then <code>1</code>, otherwise <code>0</code>.</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Custom event</div> <p>Starting with Hot Rod 2.1, custom events can return raw data that the Hot Rod client should not try to unmarshall before passing it on to the user. The way this is transmitted to the Hot Rod client is by sending <code>2</code> as the custom event marker. So, the format of the custom event remains like this:</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Event header with event specific operation code</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener ID</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Listener for which this event is directed</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Custom marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Custom event marker. For custom events whose event data needs to be unmarshalled before returning to user the value is <code>1</code>. For custom events that need to return the event data as-is to the user, the value is <code>2</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Event data</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Custom event data. If the custom marker is <code>1</code>, the bytes represent the marshalled version of the instance returned by the converter. If custom marker is <code>2</code>, it represents the byte array, as returned by the converter.</p></td> </tr> </tbody> </table> </div> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_2_2"><a class="anchor" href="#_hot_rod_protocol_2_2"></a>Hot Rod Protocol 2.2</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 8.0 </td> </tr> </table> </div> <div class="paragraph"> <p>Added support for different time units.</p> </div> <div class="sect5"> <h6 id="_operations_6"><a class="anchor" href="#_operations_6"></a>Operations</h6> <div class="paragraph"> <div class="title">Put/PutAll/PutIfAbsent/Replace/ReplaceIfUnmodified</div> <p>Common request format:</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">TimeUnits</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Time units of lifespan (first 4 bits) and maxIdle (last 4 bits). Special units DEFAULT and INFINITE can be used for default server expiration and no expiration respectively. Possible values:<br> 0x00 = SECONDS<br> 0x01 = MILLISECONDS<br> 0x02 = NANOSECONDS<br> 0x03 = MICROSECONDS<br> 0x04 = MINUTES<br> 0x05 = HOURS<br> 0x06 = DAYS<br> 0x07 = DEFAULT<br> 0x08 = INFINITE<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vLong</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Duration which the entry is allowed to life. Only sent when time unit is not DEFAULT or INFINITE</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Max Idle</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vLong</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Duration that each entry can be idle before it&#8217;s evicted from the cache. Only sent when time unit is not DEFAULT or INFINITE</p></td> </tr> </tbody> </table> </div> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_2_3"><a class="anchor" href="#_hot_rod_protocol_2_3"></a>Hot Rod Protocol 2.3</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 8.0 </td> </tr> </table> </div> <div class="sect5"> <h6 id="_operations_7"><a class="anchor" href="#_operations_7"></a>Operations</h6> <div class="paragraph"> <div class="title">Iteration Start</div> <p>Request (0x31):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Segments size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">signed vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Size of the bitset encoding of the segments ids to iterate on. The size is the maximum segment id rounded to nearest multiple of 8.<br> A value -1 indicates no segment filtering is to be done</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Segments</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(Optional) Contains the segments ids bitset encoded, where each bit with value 1 represents a segment in the set. Byte order is little-endian.<br> Example: segments [1,3,12,13] would result in the following encoding:<br> 00001010 00110000<br> size: 16 bits<br> first byte: represents segments from 0 to 7, from which 1 and 3 are set<br> second byte: represents segments from 8 to 15, from which 12 and 13 are set<br> More details in the java.util.BitSet implementation. Segments will be sent if the previous field is not negative</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">FilterConverter size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">signed vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The size of the String representing a KeyValueFilterConverter factory name deployed on the server, or -1 if no filter will be used</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">FilterConverter</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">UTF-8 byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(Optional) KeyValueFilterConverter factory name deployed on the server. Present if previous field is not negative</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">BatchSize</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">number of entries to transfers from the server at one go</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x32):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">IterationId</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">String</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The unique id of the iteration</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Iteration Next</div> <p>Request (0x33):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">IterationId</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">String</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The unique id of the iteration</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x34):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Finished segments size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">size of the bitset representing segments that were finished iterating</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Finished segments</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">bitset encoding of the segments that were finished iterating</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">How many entries are being returned</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Retrieved key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Retrieved value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203; continues until entry count is reached</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Iteration End</div> <p>Request (0x35):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">IterationId</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">String</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The unique id of the iteration</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response (0x36):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Header</th> <th class="tableblock halign-center valign-top">variable</th> <th class="tableblock halign-left valign-top">Response header</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00 = success, if execution completed successfully<br> 0x05 = for non existent IterationId <br></p></td> </tr> </tbody> </table> </div> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_2_4"><a class="anchor" href="#_hot_rod_protocol_2_4"></a>Hot Rod Protocol 2.4</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 8.1 </td> </tr> </table> </div> <div class="paragraph"> <p>This Hot Rod protocol version adds three new status code that gives the client hints on whether the server has compatibility mode enabled or not:</p> </div> <div class="ulist"> <ul> <li> <p><code>0x06</code>: Success status and compatibility mode is enabled.</p> </li> <li> <p><code>0x07</code>: Success status and return previous value, with compatibility mode is enabled.</p> </li> <li> <p><code>0x08</code>: Not executed and return previous value, with compatibility mode is enabled.</p> </li> </ul> </div> <div class="paragraph"> <p>The Iteration Start operation can optionally send parameters if a custom filter is provided and it&#8217;s parametrised:</p> </div> <div class="sect5"> <h6 id="_operations_8"><a class="anchor" href="#_operations_8"></a>Operations</h6> <div class="paragraph"> <div class="title">Iteration Start</div> <p>Request (0x31):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Segments size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">signed vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.3.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Segments</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.3.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">FilterConverter size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">signed vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.3.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">FilterConverter</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">UTF-8 byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.3.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Parameters size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">the number of params of the filter. Only present when FilterConverter is provided.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte[][]</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">an array of parameters, each parameter is a byte array. Only present if Parameters size is greater than 0.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">BatchSize</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.3.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>The Iteration Next operation can optionally return projections in the value, meaning more than one value is contained in the same entry.</p> </div> <div class="paragraph"> <div class="title">Iteration Next</div> <p>Response (0x34):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Finished segments size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.3.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Finished segments</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.3.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.3.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of value projections</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of projections for the values. If 1, behaves like version protocol version 2.3.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.3.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.3.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value1 projection1 length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">length of value1 first projection</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value1 projection1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">retrieved value1 first projection</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value1 projection2 length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">length of value2 second projection</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value1 projection2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">retrieved value2 second projection</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203; continues until all projections for the value retrieved</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Key2 Length</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">vInt</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.3.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Key2</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">byte array</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.3.</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Value2 projection1 length</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">vInt</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">length of value 2 first projection</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Value2 projection1</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">byte array</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">retrieved value 2 first projection</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Value2 projection2 length</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">vInt</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">length of value 2 second projection</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Value2 projection2</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">byte array</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">retrieved value 2 second projection</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203; continues until entry count is reached</p></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="olist arabic"> <ol class="arabic"> <li> <p>Stats:</p> </li> </ol> </div> <div class="paragraph"> <p>Statistics returned by previous Hot Rod protocol versions were local to the node where the Hot Rod operation had been called. Starting with 2.4, new statistics have been added which provide global counts for the statistics returned previously. If the Hot Rod is running in local mode, these statistics are not returned:</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 50%;"> <col style="width: 50%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Explanation</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">globalCurrentNumberOfEntries</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of entries currently across the Hot Rod cluster.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">globalStores</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Total number of put operations across the Hot Rod cluster.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">globalRetrievals</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Total number of get operations across the Hot Rod cluster.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">globalHits</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Total number of get hits across the Hot Rod cluster.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">globalMisses</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Total number of get misses across the Hot Rod cluster.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">globalRemoveHits</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Total number of removal hits across the Hot Rod cluster.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">globalRemoveMisses</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Total number of removal misses across the Hot Rod cluster.</p></td> </tr> </tbody> </table> </div> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_2_5"><a class="anchor" href="#_hot_rod_protocol_2_5"></a>Hot Rod Protocol 2.5</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 8.2 </td> </tr> </table> </div> <div class="paragraph"> <p>This Hot Rod protocol version adds support for metadata retrieval along with entries in the iterator. It includes two changes:</p> </div> <div class="ulist"> <ul> <li> <p>Iteration Start request includes an optional flag</p> </li> <li> <p>IterationNext operation may include metadata info for each entry if the flag above is set</p> </li> </ul> </div> <div class="paragraph"> <div class="title">Iteration Start</div> <p>Request (0x31):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Segments size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">signed vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Segments</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">FilterConverter size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">signed vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">FilterConverter</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">UTF-8 byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Parameters size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Parameters</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte[][]</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">BatchSize</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Metadata</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">1 if metadata is to be returned for each entry, 0 otherwise</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Iteration Next</div> <p>Response (0x34):</p> </div> <table class="tableblock frame-all grid-all spread"> <colgroup> <col style="width: 20%;"> <col style="width: 13.3333%;"> <col style="width: 66.6667%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Finished segments size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Finished segments</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of value projections</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Metadata (entry 1)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If set, entry has metadata associated</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Expiration (entry 1)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">A flag indicating whether the response contains expiration information. The value of the flag is obtained as a bitwise OR operation between INFINITE_LIFESPAN (0x01) and <code>INFINITE_MAXIDLE (0x02)</code>. Only present if the metadata flag above is set</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Created (entry 1)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Long</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(optional) a Long representing the timestamp when the entry was created on the server. This value is returned only if the flag&#8217;s INFINITE_LIFESPAN bit is not set.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan (entry 1)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(optional) a vInt representing the lifespan of the entry in seconds. This value is returned only if the flag&#8217;s INFINITE_LIFESPAN bit is not set.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">LastUsed (entry 1)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Long</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(optional) a Long representing the timestamp when the entry was last accessed on the server. This value is returned only if the flag&#8217;s <code>INFINITE_MAXIDLE</code> bit is not set.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">MaxIdle (entry 1)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(optional) a vInt representing the maxIdle of the entry in seconds. This value is returned only if the flag&#8217;s <code>INFINITE_MAXIDLE</code> bit is not set.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry Version (entry 1)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">8 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Unique value of an existing entry&#8217;s modification. Only present if Metadata flag is set</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">same as protocol version 2.4.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Metadata (entry 2)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Same as for entry 1</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Expiration (entry 2)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Same as for entry 1</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Created (entry 2)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Long</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Same as for entry 1</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan (entry 2)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Same as for entry 1</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">LastUsed (entry 2)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Long</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Same as for entry 1</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">MaxIdle (entry 2)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Same as for entry 1</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry Version (entry 2)</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">8 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Same as for entry 1</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203; continues until entry count is reached</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> </div> </div> <div class="sect3"> <h4 id="_hot_rod_hash_functions"><a class="anchor" href="#_hot_rod_hash_functions"></a>1.2. Hot Rod Hash Functions</h4> <div class="paragraph"> <p>Infinispan makes use of a consistent hash function to place nodes on a hash wheel, and to place keys of entries on the same wheel to determine where entries live.</p> </div> <div class="paragraph"> <p>In Infinispan 4.2 and earlier, the hash space was hardcoded to 10240, but since 5.0, the hash space is <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Integer.html#MAX_VALUE">Integer.MAX_INT</a> . Please note that since Hot Rod clients should not assume a particular hash space by default, every time a hash-topology change is detected, this value is sent back to the client via the Hot Rod protocol.</p> </div> <div class="paragraph"> <p>When interacting with Infinispan via the Hot Rod protocol, it is mandated that keys (and values) are byte arrays, to ensure platform neutral behavior. As such, smart-clients which are aware of hash distribution on the backend would need to be able to calculate the hash codes of such byte array keys, again in a platform-neutral manner. To this end, the hash functions used by Infinispan are versioned and documented, so that it can be re-implemented by non-Java clients if needed.</p> </div> <div class="paragraph"> <p>The version of the hash function in use is provided in the Hot Rod protocol, as the hash function version parameter.</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Version 1 (single byte, 0x01) The initial version of the hash function in use is based on <a href="https://github.com/infinispan/infinispan/blob/master/commons/src/main/java/org/infinispan/commons/hash/MurmurHash2.java">Austin Appleby&#8217;s MurmurHash 2.0 algorithm</a> , a fast, non-cryptographic hash that exhibits excellent distribution, collision resistance and avalanche behavior. The specific version of the algorithm used is the slightly slower, endian-neutral version that allows consistent behavior across both big- and little-endian CPU architectures. Infinispan&#8217;s version also hard-codes the hash seed as -1. For details of the algorithm, please visit <a href="http://sites.google.com/site/murmurhash/">Austin Appleby&#8217;s MurmurHash 2.0 page</a>. Other implementations are detailed on <a href="http://en.wikipedia.org/wiki/MurmurHash">Wikipedia</a> . This hash function was the default one used by the Hot Rod server until Infinispan 4.2.1. Since Infinispan 5.0, the server never uses hash version 1. Since Infinispan 9.0, the client ignores hash version 1.</p> </li> <li> <p>Version 2 (single byte, 0x02) Since Infinispan 5.0, a new hash function is used by default which is based on <a href="https://github.com/infinispan/infinispan/blob/master/commons/src/main/java/org/infinispan/commons/hash/MurmurHash3.java">Austin Appleby&#8217;s MurmurHash 3.0 algorithm</a>. Detailed information about the hash function can be found in this <a href="http://code.google.com/p/smhasher/wiki/MurmurHash3">wiki</a>. Compared to 2.0, it provides better performance and spread. Since Infinispan 7.0, the server only uses version 2 for HotRod 1.x clients.</p> </li> <li> <p>Version 3 (single byte, 0x03) Since Infinispan 7.0, a new hash function is used by default. The function is still based on <a href="http://code.google.com/p/smhasher/wiki/MurmurHash3">wiki</a>, but is also aware of the hash segments used in the server&#8217;s <a href="$$https://github.com/infinispan/infinispan/blob/master/core/src/main/java/org/infinispan/distribution/ch/ConsistentHash.java">ConsistentHash</a>.</p> </li> </ol> </div> </div> <div class="sect3"> <h4 id="_java_hot_rod_client"><a class="anchor" href="#_java_hot_rod_client"></a>1.3. Java Hot Rod client</h4> <div class="paragraph"> <p>Hot Rod is a binary, language neutral protocol. This article explains how a Java client can interact with a server via the Hot Rod protocol. A reference implementation of the protocol written in Java can be found in all Infinispan distributions, and this article focuses on the capabilities of this java client.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="fa icon-tip" title="Tip"></i> </td> <td class="content"> Looking for more clients? Visit <a href="http://infinispan.org/hotrod-clients">this website</a> for clients written in a variety of different languages. </td> </tr> </table> </div> <div class="sect4"> <h5 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h5> <div class="paragraph"> <p>The Java Hot Rod client can be configured both programmatically and externally, through a configuration file.</p> </div> <div class="paragraph"> <p>The code snippet below illustrates the creation of a client instance using the available Java fluent API:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">org.infinispan.client.hotrod.configuration.ConfigurationBuilder cb
      = <span class="keyword">new</span> org.infinispan.client.hotrod.configuration.ConfigurationBuilder();
cb.tcpNoDelay(<span class="predefined-constant">true</span>)
  .connectionPool()
      .numTestsPerEvictionRun(<span class="integer">3</span>)
      .testOnBorrow(<span class="predefined-constant">false</span>)
      .testOnReturn(<span class="predefined-constant">false</span>)
      .testWhileIdle(<span class="predefined-constant">true</span>)
  .addServer()
      .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>)
      .port(<span class="integer">11222</span>);
RemoteCacheManager rmc = <span class="keyword">new</span> RemoteCacheManager(cb.build());</code></pre> </div> </div> <div class="paragraph"> <p>For a complete reference to the available configuration option please refer to the <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/configuration/ConfigurationBuilder.html">ConfigurationBuilder</a>'s javadoc.</p> </div> <div class="paragraph"> <p>It is also possible to configure the Java Hot Rod client using an properties file, e.g.:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code>infinispan.client.hotrod.transport_factory = org.infinispan.client.hotrod.impl.transport.tcp.TcpTransportFactory
infinispan.client.hotrod.server_list = 12{infinispanversion}.0.1:11222
infinispan.client.hotrod.marshaller = org.infinispan.commons.marshall.jboss.GenericJBossMarshaller
infinispan.client.hotrod.async_executor_factory = org.infinispan.client.hotrod.impl.async.DefaultAsyncExecutorFactory
infinispan.client.hotrod.default_executor_factory.pool_size = 1
infinispan.client.hotrod.default_executor_factory.queue_size = 10000
infinispan.client.hotrod.tcp_no_delay = true
infinispan.client.hotrod.request_balancing_strategy = org.infinispan.client.hotrod.impl.transport.tcp.RoundRobinBalancingStrategy
infinispan.client.hotrod.key_size_estimate = 64
infinispan.client.hotrod.value_size_estimate = 512
infinispan.client.hotrod.force_return_values = false

## below is connection pooling config
maxActive=-1
maxTotal = -1
maxIdle = -1
whenExhaustedAction = 1
timeBetweenEvictionRunsMillis=120000
minEvictableIdleTimeMillis=300000
testWhileIdle = true
minIdle = 1</code></pre> </div> </div> <div class="paragraph"> <p>The properties file is then passed to one of constructors of <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html#RemoteCacheManager(java.net.URL)">RemoteCacheManager</a>. For a complete reference of the available configuration options for the properties file please refer to <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html">RemoteCacheManager</a>'s javadoc.</p> </div> </div> <div class="sect4"> <h5 id="_basic_api"><a class="anchor" href="#_basic_api"></a>Basic API</h5> <div class="paragraph"> <p>Below is a sample code snippet on how the client API can be used to store or retrieve information from a Hot Rod server using the Java Hot Rod client. It assumes that a Hot Rod server has been started bound to the default location (localhost:11222)</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="comment">//API entry point, by default it connects to localhost:11222</span>
CacheContainer cacheContainer = <span class="keyword">new</span> RemoteCacheManager();

<span class="comment">//obtain a handle to the remote default cache</span>
Cache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = cacheContainer.getCache();

<span class="comment">//now add something to the cache and make sure it is there</span>
cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ferrari</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> cache.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">ferrari</span><span class="delimiter">&quot;</span></span>);

<span class="comment">//remove the data</span>
cache.remove(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> !cache.containsKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>) : <span class="string"><span class="delimiter">&quot;</span><span class="content">Value must have been removed!</span><span class="delimiter">&quot;</span></span>;</code></pre> </div> </div> <div class="paragraph"> <p>The client API maps the local API: <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html">RemoteCacheManager</a> corresponds to <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/manager/DefaultCacheManager.html">DefaultCacheManager</a> (both implement <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/manager/CacheContainer.html">CacheContainer</a> ). This common API facilitates an easy migration from local calls to remote calls through Hot Rod: all one needs to do is switch between <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/manager/DefaultCacheManager.html">DefaultCacheManager</a> and <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html">RemoteCacheManager</a> - which is further simplified by the common <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/manager/CacheContainer.html">CacheContainer</a> interface that both inherit.</p> </div> <div class="paragraph"> <p>All keys can be retrieved from the remote cache (whether it&#8217;s local, replicated, or distributed) by using keySet() method. If the remote cache is a distributed cache, the server will perform a distributed stream operation to retrieve all keys from clustered nodes, and return all keys to the client. Please use this method with care if there are large number of keys.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Set</span> keys = remoteCache.keySet();</code></pre> </div> </div> <div class="paragraph"> <p>Alternatively, if memory is a concern, use the remote iterator api to retrieve entries from the server:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Retrieve all entries in batches of 1000</span>
<span class="type">int</span> batchSize = <span class="integer">1000</span>;
<span class="keyword">try</span> (CloseableIterator&lt;Entry&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt;&gt; iterator = remoteCache.retrieveEntries(<span class="predefined-constant">null</span>, batchSize)) {
     <span class="keyword">while</span>(iterator.hasNext()) {
        <span class="comment">// Do something</span>
     }
}

<span class="comment">// Filter by segment</span>
<span class="predefined-type">Set</span>&lt;<span class="predefined-type">Integer</span>&gt; segments = ...
try (CloseableIterator&lt;Entry&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt;&gt; iterator = remoteCache.retrieveEntries(<span class="predefined-constant">null</span>, segments, batchSize)) {
     <span class="keyword">while</span>(iterator.hasNext()) {
        <span class="comment">// Do something</span>
     }
}

<span class="comment">// Filter by custom filter</span>
<span class="keyword">try</span> (CloseableIterator&lt;Entry&lt;<span class="predefined-type">Object</span>, <span class="predefined-type">Object</span>&gt;&gt; iterator = remoteCache.retrieveEntries(<span class="string"><span class="delimiter">&quot;</span><span class="content">myFilterConverterFactory</span><span class="delimiter">&quot;</span></span>, segments, batchSize)) {
     <span class="keyword">while</span>(iterator.hasNext()) {
        <span class="comment">// Do something</span>
     }
}</code></pre> </div> </div> <div class="paragraph"> <p>In order to use custom filters, it&#8217;s necessary to deploy them first in the server. Follow the steps:</p> </div> <div class="ulist"> <ul> <li> <p>Create a factory for the filter extending <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/filter/KeyValueFilterConverterFactory.html">KeyValueFilterConverterFactory</a>, annotated with @NamedFactory containing the name of the factory, example:</p> </li> </ul> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">java.io.Serializable</span>;

<span class="keyword">import</span> <span class="include">org.infinispan.filter.AbstractKeyValueFilterConverter</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.filter.KeyValueFilterConverter</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.filter.KeyValueFilterConverterFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.filter.NamedFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.metadata.Metadata</span>;

<span class="annotation">@NamedFactory</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">myFilterConverterFactory</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyKeyValueFilterConverterFactory</span> <span class="directive">implements</span> KeyValueFilterConverterFactory {

   <span class="annotation">@Override</span>
   <span class="directive">public</span> KeyValueFilterConverter&lt;<span class="predefined-type">String</span>, SampleEntity1, SampleEntity2&gt; getFilterConverter() {
      <span class="keyword">return</span> <span class="keyword">new</span> MyKeyValueFilterConverter();
   }
   <span class="comment">// Filter implementation. Should be serializable or externalizable for DIST caches</span>
   <span class="directive">static</span> <span class="type">class</span> <span class="class">MyKeyValueFilterConverter</span> <span class="directive">extends</span> AbstractKeyValueFilterConverter&lt;<span class="predefined-type">String</span>, SampleEntity1, SampleEntity2&gt; <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
      <span class="annotation">@Override</span>
      <span class="directive">public</span> SampleEntity2 filterAndConvert(<span class="predefined-type">String</span> key, SampleEntity1 entity, Metadata metadata) {
         <span class="comment">// returning null will case the entry to be filtered out</span>
         <span class="comment">// return SampleEntity2 will convert from the cache type SampleEntity1</span>
      }
   }
}</code></pre> </div> </div> <div class="ulist"> <ul> <li> <p>Create a jar with a <code>META-INF/services/org.infinispan.filter.KeyValueFilterConverterFactory</code> file and within it, write the fully qualified class name of the filter factory class implementation.</p> </li> <li> <p>Optional: If the filter uses custom key/value classes, these must be included in the JAR so that the filter can correctly unmarshall key and/or value instances.</p> </li> <li> <p>Deploy the JAR file in the Infinispan Server.</p> </li> </ul> </div> </div> <div class="sect4"> <h5 id="_versioned_api"><a class="anchor" href="#_versioned_api"></a>Versioned API</h5> <div class="paragraph"> <p>A RemoteCacheManager provides instances of <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> interface that represents a handle to the named or default cache on the remote cluster. API wise, it extends the <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/Cache.html">Cache</a> interface to which it also adds some new methods, including the so called versioned API. Please find below some examples of this API <a href="#sid-68355052">but to understand the motivation behind it, make sure you read this section</a>.</p> </div> <div class="paragraph"> <p>The code snippet bellow depicts the usage of these versioned methods:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// To use the versioned API, remote classes are specifically needed</span>
RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager();
RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = remoteCacheManager.getCache();

remoteCache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ferrari</span><span class="delimiter">&quot;</span></span>);
RemoteCache.VersionedValue valueBinary = remoteCache.getVersioned(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// removal only takes place only if the version has not been changed</span>
<span class="comment">// in between. (a new version is associated with 'car' key on each change)</span>
<span class="keyword">assert</span> remoteCache.remove(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>, valueBinary.getVersion());
<span class="keyword">assert</span> !cache.containsKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>);</code></pre> </div> </div> <div class="paragraph"> <p>In a similar way, for replace:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">remoteCache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ferrari</span><span class="delimiter">&quot;</span></span>);
RemoteCache.VersionedValue valueBinary = remoteCache.getVersioned(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> remoteCache.replace(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">lamborghini</span><span class="delimiter">&quot;</span></span>, valueBinary.getVersion());</code></pre> </div> </div> <div class="paragraph"> <p>For more details on versioned operations refer to <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> 's javadoc.</p> </div> </div> <div class="sect4"> <h5 id="_async_api"><a class="anchor" href="#_async_api"></a>Async API</h5> <div class="paragraph"> <p>This cool feature is "borrowed" from the Infinispan core and it is largely discussed <a href="#_asynchronous_api">here</a></p> </div> </div> <div class="sect4"> <h5 id="_client_event_listener_api"><a class="anchor" href="#_client_event_listener_api"></a>Client Event Listener API</h5> <div class="paragraph"> <p>Starting with Infinispan 7.0, Java Hot Rod clients can register listeners to receive cache-entry level events. In 7.0, cache entry created, modified and removed events are supported.</p> </div> <div class="sect5"> <h6 id="_creating_a_client_event_listener"><a class="anchor" href="#_creating_a_client_event_listener"></a>Creating a Client Event Listener</h6> <div class="paragraph"> <p>Creating a client listener is very similar to embedded listeners, except that different annotations and event classes are used. Here&#8217;s an example of a client listener that prints out each event received:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.annotation</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.event</span>.*;

<span class="annotation">@ClientListener</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EventPrintListener</span> {

   <span class="annotation">@ClientCacheEntryCreated</span>
   <span class="directive">public</span> <span class="type">void</span> handleCreatedEvent(ClientCacheEntryCreatedEvent e) {
      <span class="predefined-type">System</span>.out.println(e);
   }

   <span class="annotation">@ClientCacheEntryModified</span>
   <span class="directive">public</span> <span class="type">void</span> handleModifiedEvent(ClientCacheEntryModifiedEvent e) {
      <span class="predefined-type">System</span>.out.println(e);
   }

   <span class="annotation">@ClientCacheEntryRemoved</span>
   <span class="directive">public</span> <span class="type">void</span> handleRemovedEvent(ClientCacheEntryRemovedEvent e) {
      <span class="predefined-type">System</span>.out.println(e);
   }

}</code></pre> </div> </div> <div class="paragraph"> <p><code>ClientCacheEntryCreatedEvent</code> and <code>ClientCacheEntryModifiedEvent</code> instances provide information on the affected key, and the version of the entry. This version can be used to invoke conditional operations on the server, such as <code>replaceWithVersion</code> or <code>removeWithVersion</code>.</p> </div> <div class="paragraph"> <p><code>ClientCacheEntryRemovedEvent</code> events are only sent when the remove operation succeeds. In other words, if a remove operation is invoked but no entry is found or no entry should be removed, no event is generated. Users interested in removed events, even when no entry was removed, can develop event customization logic to generate such events. More information can be found in the <a href="#_customizing_client_events_contents">customizing client events section</a>.</p> </div> <div class="paragraph"> <p>All <code>ClientCacheEntryCreatedEvent</code>, <code>ClientCacheEntryModifiedEvent</code> and <code>ClientCacheEntryRemovedEvent</code> event instances also provide a <code>boolean isCommandRetried()</code> method that will return true if the write command that caused this had to be retried again due to a topology change. This could be a sign that this event has been duplicated or another event was dropped and replaced (eg: ClientCacheEntryModifiedEvent replaced ClientCacheEntryCreatedEvent).</p> </div> <div class="paragraph"> <p>Once the client listener implementation has been created, it needs to be registered with the server. To do so, execute:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(<span class="keyword">new</span> EventPrintListener());</code></pre> </div> </div> </div> <div class="sect5"> <h6 id="_remove_a_client_event_listener"><a class="anchor" href="#_remove_a_client_event_listener"></a>Remove a Client Event Listener</h6> <div class="paragraph"> <p>When an client event listener is not needed any more, it can be removed:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">EventPrintListener listener = ...
cache.removeClientListener(listener);</code></pre> </div> </div> </div> <div class="sect5"> <h6 id="_filtering_client_events"><a class="anchor" href="#_filtering_client_events"></a>Filtering Client Events</h6> <div class="paragraph"> <p>In order to avoid inundating clients with events, users can provide filtering functionality to limit the number of events fired by the server for a particular client listener. To enable filtering, a cache event filter factory needs to be created that produces filter instances:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventFilterFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.filter.NamedFactory</span>;

<span class="annotation">@NamedFactory</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">static-filter</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">StaticCacheEventFilterFactory</span> <span class="directive">implements</span> CacheEventFilterFactory {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> CacheEventFilterFactory&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; getFilter(<span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="keyword">return</span> <span class="keyword">new</span> StaticCacheEventFilter();
   }
}

<span class="comment">// Serializable, Externalizable or marshallable with Infinispan Externalizers</span>
<span class="comment">// needed when running in a cluster</span>
<span class="type">class</span> <span class="class">StaticCacheEventFilter</span> <span class="directive">implements</span> CacheEventFilter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt;, <span class="predefined-type">Serializable</span> {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">boolean</span> accept(<span class="predefined-type">Integer</span> key, <span class="predefined-type">String</span> oldValue, Metadata oldMetadata,
         <span class="predefined-type">String</span> newValue, Metadata newMetadata, EventType eventType) {
      <span class="keyword">if</span> (key.equals(<span class="integer">1</span>)) <span class="comment">// static key</span>
         <span class="keyword">return</span> <span class="predefined-constant">true</span>;

      <span class="keyword">return</span> <span class="predefined-constant">false</span>;
   }
}</code></pre> </div> </div> <div class="paragraph"> <p>The cache event filter factory instance defined above creates filter instances which statically filter out all entries except the one whose key is <code>1</code>.</p> </div> <div class="paragraph"> <p>To be able to register a listener with this cache event filter factory, the factory has to be given a unique name, and the Hot Rod server needs to be plugged with the name and the cache event filter factory instance. Plugging the Infinispan Server with a custom filter involves the following steps:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Create a JAR file with the filter implementation within it.</p> </li> <li> <p>Optional: If the cache uses custom key/value classes, these must be included in the JAR so that the callbacks can be executed with the correctly unmarshalled key and/or value instances. If the client listener has <code>useRawData</code> enabled, this is not necessary since the callback key/value instances will be provided in binary format.</p> </li> <li> <p>Create a <code>META-INF/services/org.infinispan.notifications.cachelistener.filter.CacheEventFilterFactory</code> file within the JAR file and within it, write the fully qualified class name of the filter class implementation.</p> </li> <li> <p>Deploy the JAR file in the Infinispan Server.</p> </li> </ol> </div> <div class="paragraph"> <p>On top of that, the client listener needs to be linked with this cache event filter factory by adding the factory&#8217;s name to the @ClientListener annotation:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ClientListener</span>(filterFactoryName = <span class="string"><span class="delimiter">&quot;</span><span class="content">static-filter</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EventPrintListener</span> { ... }</code></pre> </div> </div> <div class="paragraph"> <p>And, register the listener with the server:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(<span class="keyword">new</span> EventPrintListener());</code></pre> </div> </div> <div class="paragraph"> <p>Dynamic filter instances that filter based on parameters provided when the listener is registered are also possible. Filters use the parameters received by the filter factories to enable this option. For example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventFilterFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventFilter</span>;

<span class="type">class</span> <span class="class">DynamicCacheEventFilterFactory</span> <span class="directive">implements</span> CacheEventFilterFactory {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> CacheEventFilter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt; getFilter(<span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="keyword">return</span> <span class="keyword">new</span> DynamicCacheEventFilter(params);
   }
}

<span class="comment">// Serializable, Externalizable or marshallable with Infinispan Externalizers</span>
<span class="comment">// needed when running in a cluster</span>
<span class="type">class</span> <span class="class">DynamicCacheEventFilter</span> <span class="directive">implements</span> CacheEventFilter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>&gt;, <span class="predefined-type">Serializable</span> {
   <span class="directive">final</span> <span class="predefined-type">Object</span><span class="type">[]</span> params;

   DynamicCacheEventFilter(<span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="local-variable">this</span>.params = params;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">boolean</span> accept(<span class="predefined-type">Integer</span> key, <span class="predefined-type">String</span> oldValue, Metadata oldMetadata,
         <span class="predefined-type">String</span> newValue, Metadata newMetadata, EventType eventType) {
      <span class="keyword">if</span> (key.equals(params[<span class="integer">0</span>])) <span class="comment">// dynamic key</span>
         <span class="keyword">return</span> <span class="predefined-constant">true</span>;

      <span class="keyword">return</span> <span class="predefined-constant">false</span>;
   }
}</code></pre> </div> </div> <div class="paragraph"> <p>The dynamic parameters required to do the filtering are provided when the listener is registered:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(<span class="keyword">new</span> EventPrintListener(), <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{<span class="integer">1</span>}, <span class="predefined-constant">null</span>);</code></pre> </div> </div> <div class="admonitionblock warning"> <table> <tr> <td class="icon"> <i class="fa icon-warning" title="Warning"></i> </td> <td class="content"> Filter instances have to marshallable when they are deployed in a cluster so that the filtering can happen right where the event is generated, even if the even is generated in a different node to where the listener is registered. To make them marshallable, either make them extend <code>Serializable</code>, <code>Externalizable</code>, or provide a custom <code>Externalizer</code> for them. </td> </tr> </table> </div> </div> <div class="sect5"> <h6 id="_customizing_client_events_contents"><a class="anchor" href="#_customizing_client_events_contents"></a>Customizing Client Events contents</h6> <div class="paragraph"> <p>The events generated by default contain just enough information to make the event relevant but they avoid cramming too much information in order to reduce the cost of sending them. Optionally, the information shipped in the events can be customised in order to contain more information, such as values, or to contain even less information. This customization is done with <code>CacheEventConverter</code> instances generated by a <code>CacheEventConverterFactory</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventConverterFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventConverter</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.filter.NamedFactory</span>;

<span class="annotation">@NamedFactory</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">static-converter</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">StaticConverterFactory</span> <span class="directive">implements</span> CacheEventConverterFactory {
   <span class="directive">final</span> CacheEventConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt; staticConverter = <span class="keyword">new</span> StaticCacheEventConverter();
   <span class="directive">public</span> CacheEventConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt; getConverter(<span class="directive">final</span> <span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="keyword">return</span> staticConverter;
   }
}

<span class="comment">// Serializable, Externalizable or marshallable with Infinispan Externalizers</span>
<span class="comment">// needed when running in a cluster</span>
<span class="type">class</span> <span class="class">StaticCacheEventConverter</span> <span class="directive">implements</span> CacheEventConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt;, <span class="predefined-type">Serializable</span> {
   <span class="directive">public</span> CustomEvent convert(<span class="predefined-type">Integer</span> key, <span class="predefined-type">String</span> oldValue, Metadata oldMetadata, <span class="predefined-type">String</span> newValue, Metadata newMetadata, EventType eventType) {
      <span class="keyword">return</span> <span class="keyword">new</span> CustomEvent(key, newValue);
   }
}

<span class="comment">// Needs to be Serializable, Externalizable or marshallable with Infinispan Externalizers</span>
<span class="comment">// regardless of cluster or local caches</span>
<span class="directive">static</span> <span class="type">class</span> <span class="class">CustomEvent</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
   <span class="directive">final</span> <span class="predefined-type">Integer</span> key;
   <span class="directive">final</span> <span class="predefined-type">String</span> value;
   CustomEvent(<span class="predefined-type">Integer</span> key, <span class="predefined-type">String</span> value) {
      <span class="local-variable">this</span>.key = key;
      <span class="local-variable">this</span>.value = value;
   }
}</code></pre> </div> </div> <div class="paragraph"> <p>In the example above, the converter generates a new custom event which includes the value as well as the key in the event. This will result in bigger event payloads compared with default events, but if combined with filtering, it can reduce its network bandwidth cost.</p> </div> <div class="admonitionblock warning"> <table> <tr> <td class="icon"> <i class="fa icon-warning" title="Warning"></i> </td> <td class="content"> The target type of the converter must be either <code>Serializable</code> or <code>Externalizable</code>. In this particular case of converters, providing an Externalizer will not work by default since the default Hot Rod client marshaller does not support them. </td> </tr> </table> </div> <div class="paragraph"> <p>Handling custom events requires a slightly different client listener implementation to the one demonstrated previously. To be more precise, it needs to handle <code>ClientCacheEntryCustomEvent</code> instances:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.annotation</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.event</span>.*;

<span class="annotation">@ClientListener</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomEventPrintListener</span> {

   <span class="annotation">@ClientCacheEntryCreated</span>
   <span class="annotation">@ClientCacheEntryModified</span>
   <span class="annotation">@ClientCacheEntryRemoved</span>
   <span class="directive">public</span> <span class="type">void</span> handleCustomEvent(ClientCacheEntryCustomEvent&lt;CustomEvent&gt; e) {
      <span class="predefined-type">System</span>.out.println(e);
   }

}</code></pre> </div> </div> <div class="paragraph"> <p>The <code>ClientCacheEntryCustomEvent</code> received in the callback exposes the custom event via <code>getEventData</code> method, and the <code>getType</code> method provides information on whether the event generated was as a result of cache entry creation, modification or removal.</p> </div> <div class="paragraph"> <p>Similar to filtering, to be able to register a listener with this converter factory, the factory has to be given a unique name, and the Hot Rod server needs to be plugged with the name and the cache event converter factory instance. Plugging the Infinispan Server with an event converter involves the following steps:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Create a JAR file with the converter implementation within it.</p> </li> <li> <p>Optional: If the cache uses custom key/value classes, these must be included in the JAR so that the callbacks can be executed with the correctly unmarshalled key and/or value instances. If the client listener has <code>useRawData</code> enabled, this is not necessary since the callback key/value instances will be provided in binary format.</p> </li> <li> <p>Create a <code>META-INF/services/org.infinispan.notifications.cachelistener.filter.CacheEventConverterFactory</code> file within the JAR file and within it, write the fully qualified class name of the converter class implementation.</p> </li> <li> <p>Deploy the JAR file in the Infinispan Server.</p> </li> </ol> </div> <div class="paragraph"> <p>On top of that, the client listener needs to be linked with this converter factory by adding the factory&#8217;s name to the @ClientListener annotation:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ClientListener</span>(converterFactoryName = <span class="string"><span class="delimiter">&quot;</span><span class="content">static-converter</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomEventPrintListener</span> { ... }</code></pre> </div> </div> <div class="paragraph"> <p>And, register the listener with the server:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(<span class="keyword">new</span> CustomEventPrintListener());</code></pre> </div> </div> <div class="paragraph"> <p>Dynamic converter instances that convert based on parameters provided when the listener is registered are also possible. Converters use the parameters received by the converter factories to enable this option. For example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventConverterFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventConverter</span>;

<span class="annotation">@NamedFactory</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">dynamic-converter</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">DynamicCacheEventConverterFactory</span> <span class="directive">implements</span> CacheEventConverterFactory {
   <span class="directive">public</span> CacheEventConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt; getConverter(<span class="directive">final</span> <span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="keyword">return</span> <span class="keyword">new</span> DynamicCacheEventConverter(params);
   }
}

<span class="comment">// Serializable, Externalizable or marshallable with Infinispan Externalizers needed when running in a cluster</span>
<span class="type">class</span> <span class="class">DynamicCacheEventConverter</span> <span class="directive">implements</span> CacheEventConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt;, <span class="predefined-type">Serializable</span> {
   <span class="directive">final</span> <span class="predefined-type">Object</span><span class="type">[]</span> params;

   DynamicCacheEventConverter(<span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="local-variable">this</span>.params = params;
   }

   <span class="directive">public</span> CustomEvent convert(<span class="predefined-type">Integer</span> key, <span class="predefined-type">String</span> oldValue, Metadata oldMetadata,
         <span class="predefined-type">String</span> newValue, Metadata newMetadata, EventType eventType) {
      <span class="comment">// If the key matches a key given via parameter, only send the key information</span>
      <span class="keyword">if</span> (params[<span class="integer">0</span>].equals(key))
         <span class="keyword">return</span> <span class="keyword">new</span> CustomEvent(key, <span class="predefined-constant">null</span>);

      <span class="keyword">return</span> <span class="keyword">new</span> CustomEvent(key, newValue);
   }
}</code></pre> </div> </div> <div class="paragraph"> <p>The dynamic parameters required to do the conversion are provided when the listener is registered:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(<span class="keyword">new</span> EventPrintListener(), <span class="predefined-constant">null</span>, <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{<span class="integer">1</span>});</code></pre> </div> </div> <div class="admonitionblock warning"> <table> <tr> <td class="icon"> <i class="fa icon-warning" title="Warning"></i> </td> <td class="content"> Converter instances have to marshallable when they are deployed in a cluster, so that the conversion can happen right where the event is generated, even if the even is generated in a different node to where the listener is registered. To make them marshallable, either make them extend <code>Serializable</code>, <code>Externalizable</code>, or provide a custom <code>Externalizer</code> for them. </td> </tr> </table> </div> </div> <div class="sect5"> <h6 id="_filtering_and_customizing_client_events"><a class="anchor" href="#_filtering_and_customizing_client_events"></a>Filtering and Customizing Client Events</h6> <div class="paragraph"> <p>If you want to do both event filtering and customization, it&#8217;s easier to implement <code>org.infinispan.notifications.cachelistener.filter.CacheEventFilterConverter</code> which allows both filter and customization to happen in a single step. For convenience, it&#8217;s recommended to extend <code>org.infinispan.notifications.cachelistener.filter.AbstractCacheEventFilterConverter</code> instead of implementing <code>org.infinispan.notifications.cachelistener.filter.CacheEventFilterConverter</code> directly. For example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventConverterFactory</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.notifications.cachelistener.filter.CacheEventConverter</span>;

<span class="annotation">@NamedFactory</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">dynamic-filter-converter</span><span class="delimiter">&quot;</span></span>)
<span class="type">class</span> <span class="class">DynamicCacheEventFilterConverterFactory</span> <span class="directive">implements</span> CacheEventFilterConverterFactory {
   <span class="directive">public</span> CacheEventFilterConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt; getFilterConverter(<span class="directive">final</span> <span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="keyword">return</span> <span class="keyword">new</span> DynamicCacheEventFilterConverter(params);
   }
}

<span class="comment">// Serializable, Externalizable or marshallable with Infinispan Externalizers needed when running in a cluster</span>
<span class="comment">//</span>
<span class="type">class</span> <span class="class">DynamicCacheEventFilterConverter</span> <span class="directive">extends</span> AbstractCacheEventFilterConverter&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, CustomEvent&gt;, <span class="predefined-type">Serializable</span> {
   <span class="directive">final</span> <span class="predefined-type">Object</span><span class="type">[]</span> params;

   DynamicCacheEventFilterConverter(<span class="predefined-type">Object</span><span class="type">[]</span> params) {
      <span class="local-variable">this</span>.params = params;
   }

   <span class="directive">public</span> CustomEvent filterAndConvert(<span class="predefined-type">Integer</span> key, <span class="predefined-type">String</span> oldValue, Metadata oldMetadata,
         <span class="predefined-type">String</span> newValue, Metadata newMetadata, EventType eventType) {
      <span class="comment">// If the key matches a key given via parameter, only send the key information</span>
      <span class="keyword">if</span> (params[<span class="integer">0</span>].equals(key))
         <span class="keyword">return</span> <span class="keyword">new</span> CustomEvent(key, <span class="predefined-constant">null</span>);

      <span class="keyword">return</span> <span class="keyword">new</span> CustomEvent(key, newValue);
   }
}</code></pre> </div> </div> <div class="paragraph"> <p>Similar to filters and converters, to be able to register a listener with this combined filter/converter factory, the factory has to be given a unique name via the <code>@NamedFactory</code> annotation, and the Hot Rod server needs to be plugged with the name and the cache event converter factory instance. Plugging the Infinispan Server with an event converter involves the following steps:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Create a JAR file with the converter implementation within it.</p> </li> <li> <p>Optional: If the cache uses custom key/value classes, these must be included in the JAR so that the callbacks can be executed with the correctly unmarshalled key and/or value instances. If the client listener has <code>useRawData</code> enabled, this is not necessary since the callback key/value instances will be provided in binary format.</p> </li> <li> <p>Create a <code>META-INF/services/org.infinispan.notifications.cachelistener.filter.CacheEventFilterConverterFactory</code> file within the JAR file and within it, write the fully qualified class name of the converter class implementation.</p> </li> <li> <p>Deploy the JAR file in the Infinispan Server.</p> </li> </ol> </div> <div class="paragraph"> <p>From a client perspective, to be able to use the combined filter and converter class, the client listener must define the same filter factory and converter factory names, e.g.:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ClientListener</span>(filterFactoryName = <span class="string"><span class="delimiter">&quot;</span><span class="content">dynamic-filter-converter</span><span class="delimiter">&quot;</span></span>, converterFactoryName = <span class="string"><span class="delimiter">&quot;</span><span class="content">dynamic-filter-converter</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomEventPrintListener</span> { ... }</code></pre> </div> </div> <div class="paragraph"> <p>The dynamic parameters required in the example above are provided when the listener is registered via either filter or converter parameters. If filter parameters are non-empty, those are used, otherwise, the converter parameters:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;?, ?&gt; cache = ...
cache.addClientListener(<span class="keyword">new</span> CustomEventPrintListener(), <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span>{<span class="integer">1</span>}, <span class="predefined-constant">null</span>);</code></pre> </div> </div> </div> <div class="sect5"> <h6 id="_event_marshalling"><a class="anchor" href="#_event_marshalling"></a>Event Marshalling</h6> <div class="paragraph"> <p>Hot Rod servers store data as byte arrays, but in spite of that, Java Hot Rod client users can still develop <code>CacheEventConverter</code> or <code>CacheEventFilter</code> instances that worked on typed objects. The way this is done is by making the Hot Rod server use the same marshaller as the one used by the Java Hot Rod client. This is enabled by default.</p> </div> <div class="paragraph"> <p>However, users are free to plug a custom <code>org.infinispan.commons.marshall.Marshaller</code> implementation in order to marshall objects using alternative techniques to the one used by default by the Hot Rod Java client. For example, a user might want to marshall objects using Google Protocol Buffers.</p> </div> <div class="paragraph"> <p>As indicated in the <a href="#_marshalling_data">Marshalling data</a> section, Hot Rod Java clients can be configured to use a different <code>org.infinispan.commons.marshall.Marshaller</code> instance. If doing this and deploying <code>CacheEventConverter</code> or <code>CacheEventFilter</code> instances, the same marshaller instance needs to be deployed in the server so that callback parameters of <code>CacheEventConverter</code> or <code>CacheEventFilter</code> instances can be correctly unmarshalled.</p> </div> <div class="paragraph"> <p>To deploy a Marshaller instance server-side, follow a similar method to the one used to deploy <code>CacheEventConverter</code> or <code>CacheEventFilter</code> instances:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Create a JAR file with the converter implementation within it.</p> </li> <li> <p>Create a <code>META-INF/services/org.infinispan.commons.marshall.Marshaller</code> file within the JAR file and within it, write the fully qualified class name of the marshaller class implementation.</p> </li> <li> <p>Deploy the JAR file in the Infinispan Server.</p> </li> </ol> </div> <div class="paragraph"> <p>Note that the Marshaller could be deployed in either a separate jar, or in the same jar as the <code>CacheEventConverter</code> and/or <code>CacheEventFilter</code> instances. Also, currently deployment of a single <code>org.infinispan.commons.marshall.Marshaller</code> instance is supported. If multiple marshaller instances are deployed, warning messages will be displayed as reminder indicating which marshaller instance will be used.</p> </div> </div> <div class="sect5"> <h6 id="_client_event_listener_state_consumption"><a class="anchor" href="#_client_event_listener_state_consumption"></a>Client Event Listener State Consumption</h6> <div class="paragraph"> <p>Client listener annotation has an optional <code>includeCurrentState</code> attribute that specifies whether state will be sent to the client when the listener is added or when there&#8217;s a failover of the listener.</p> </div> <div class="paragraph"> <p>By default, <code>includeCurrentState</code> is false, but if set to true and a client listener is added in a cache already containing data, the server iterates over the cache contents and sends an event for each entry to the client as a <code>ClientCacheEntryCreated</code> (or custom event if configured). This allows clients to build some local data structures based on the existing content. Once the content has been iterated over, events are received as normal, as cache updates are received. If the cache is clustered, the entire cluster wide contents are iterated over.</p> </div> <div class="paragraph"> <p><code>includeCurrentState</code> also controls whether state is received when the node where the client event listener is registered fails and it&#8217;s moved to a different node. The next section discusses this topic in depth.</p> </div> </div> <div class="sect5"> <h6 id="_client_event_listener_failure_handling"><a class="anchor" href="#_client_event_listener_failure_handling"></a>Client Event Listener Failure Handling</h6> <div class="paragraph"> <p>When a Hot Rod client registers a client listener, it does so in a single node in a cluster. If that node fails, the Java Hot Rod client detects that transparently and fails over all listeners registered in the node that failed to another node.</p> </div> <div class="paragraph"> <p>During this fail over the client might miss some events. To avoid missing these events, the client listener annotation contains an optional parameter called <code>includeCurrentState</code> which if set to true, when the failover happens, the cache contents can iterated over and <code>ClientCacheEntryCreated</code> events (or custom events if configured) are generated. By default, <code>includeCurrentState</code> is set to false.</p> </div> <div class="paragraph"> <p>Java Hot Rod clients can be made aware of such fail over event by adding a callback to handle it:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ClientCacheFailover</span>
<span class="directive">public</span> <span class="type">void</span> handleFailover(ClientCacheFailoverEvent e) {
  ...
}</code></pre> </div> </div> <div class="paragraph"> <p>This is very useful in use cases where the client has cached some data, and as a result of the fail over, taking in account that some events could be missed, it could decide to clear any locally cached data when the fail over event is received, with the knowledge that after the fail over event, it will receive events for the contents of the entire cache.</p> </div> </div> </div> <div class="sect4"> <h5 id="_near_caching"><a class="anchor" href="#_near_caching"></a>Near Caching</h5> <div class="paragraph"> <p>The Java Hot Rod client can be optionally configured with a near cache, which means that the Hot Rod client can keep a local cache that stores recently used data. Enabling near caching can significantly improve the performance of read operations <code>get</code> and <code>getVersioned</code> since data can potentially be located locally within the Hot Rod client instead of having to go remote.</p> </div> <div class="paragraph"> <p>To enable near caching, the user must set the near cache mode to <code>INVALIDATED</code>. By doing that near cache is populated upon retrievals from the server via calls to <code>get</code> or <code>getVersioned</code> operations. When near cached entries are updated or removed server-side, the cached near cache entries are invalidated. If a key is requested after it&#8217;s been invalidated, it&#8217;ll have to be re-fetched from the server.</p> </div> <div class="paragraph"> <p>When near cache is enabled, its size must be configured by defining the maximum number of entries to keep in the near cache. When the maximum is reached, near cached entries are evicted using a least-recently-used (LRU) algorithm. If providing 0 or a negative value, it is assumed that the near cache is unbounded.</p> </div> <div class="admonitionblock warning"> <table> <tr> <td class="icon"> <i class="fa icon-warning" title="Warning"></i> </td> <td class="content"> Users should be careful when configuring near cache to be unbounded since it shifts the responsibility to keep the near cache&#8217;s size within the boundaries of the client JVM to the user. </td> </tr> </table> </div> <div class="paragraph"> <p>The Hot Rod client&#8217;s near cache mode is configured using the <code>NearCacheMode</code> enumeration and calling:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.configuration.ConfigurationBuilder</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.configuration.NearCacheMode</span>;
...

<span class="comment">// Unbounded invalidated near cache</span>
ConfigurationBuilder unbounded = <span class="keyword">new</span> ConfigurationBuilder();
unbounded.nearCache().mode(NearCacheMode.INVALIDATED).maxEntries(-<span class="integer">1</span>);

<span class="comment">// Bounded invalidated near cache</span>
ConfigurationBuilder bounded = <span class="keyword">new</span> ConfigurationBuilder();
bounded.nearCache().mode(NearCacheMode.INVALIDATED).maxEntries(<span class="integer">100</span>);</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> Near caches work the same way for local caches as they do for clustered caches, but in a clustered cache scenario, if the server node sending the near cache notifications to the Hot Rod client goes down, the Hot Rod client transparently fails over to another node in the cluster, clearing the near cache along the way. </td> </tr> </table> </div> </div> <div class="sect4"> <h5 id="_unsupported_methods"><a class="anchor" href="#_unsupported_methods"></a>Unsupported methods</h5> <div class="paragraph"> <p>Some of the <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/Cache.html">Cache</a> methods are not being supported by the <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> . Calling one of these methods results in an <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/UnsupportedOperationException.html">UnsupportedOperationException</a> being thrown. Most of these methods do not make sense on the remote cache (e.g. listener management operations), or correspond to methods that are not supported by local cache as well (e.g. containsValue). Another set of unsupported operations are some of the atomic operations inherited from <a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentMap.html">ConcurrentMap</a> :</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="type">boolean</span> remove(<span class="predefined-type">Object</span> key, <span class="predefined-type">Object</span> value);
<span class="type">boolean</span> replace(<span class="predefined-type">Object</span> key, <span class="predefined-type">Object</span> value);
<span class="type">boolean</span> replace(<span class="predefined-type">Object</span> key, <span class="predefined-type">Object</span> oldValue, <span class="predefined-type">Object</span> value);</code></pre> </div> </div> <div class="paragraph"> <p><a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> offers alternative versioned methods for these atomic operations, that are also network friendly, by not sending the whole value object over the network, but a version identifier. See the section on versioned API.</p> </div> <div class="paragraph"> <p>Each one of these unsupported operation is documented in the <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> javadoc.</p> </div> </div> </div> <div class="sect3"> <h4 id="_return_values"><a class="anchor" href="#_return_values"></a>1.4. Return values</h4> <div class="paragraph"> <p>There is a set of methods that alter a cached entry and return the previous existing value, e.g.:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">V remove(<span class="predefined-type">Object</span> key);
V put(K key, V value);</code></pre> </div> </div> <div class="paragraph"> <p>By default on RemoteCache, these operations return null even if such a previous value exists. This approach reduces the amount of data sent over the network. However, if these return values are needed they can be enforced on a per invocation basis using flags:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">aKey</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">initialValue</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> <span class="predefined-constant">null</span> == cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">aKey</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">aValue</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">aValue</span><span class="delimiter">&quot;</span></span>.equals(cache.withFlags(Flag.FORCE_RETURN_VALUE).put(<span class="string"><span class="delimiter">&quot;</span><span class="content">aKey</span><span class="delimiter">&quot;</span></span>,
<span class="error"> </span><span class="error"> </span> <span class="string"><span class="delimiter">&quot;</span><span class="content">newValue</span><span class="delimiter">&quot;</span></span>));</code></pre> </div> </div> <div class="paragraph"> <p>This default behavior can can be changed through force-return-value=true configuration parameter (see configuration section bellow).</p> </div> </div> <div class="sect3"> <h4 id="_intelligence"><a class="anchor" href="#_intelligence"></a>1.5. Intelligence</h4> <div class="paragraph"> <p>HotRod defines three level of intelligence for the clients:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>basic client, interested in neither cluster nor hash information</p> </li> <li> <p>topology-aware client, interested in cluster information</p> </li> <li> <p>hash-distribution-aware client, that is interested in both cluster and hash information</p> </li> </ol> </div> <div class="paragraph"> <p>The java client supports all 3 levels of intelligence. It is transparently notified whenever a new server is added/removed from the HotRod cluster. At startup it only needs to know the address of one HotRod server (ip:host). On connection to the server the cluster topology is piggybacked to the client, and all further requests are being dispatched to all available servers. Any further topology change is also piggybacked.</p> </div> <div class="sect4"> <h5 id="_distribution_aware_client"><a class="anchor" href="#_distribution_aware_client"></a>Distribution-aware client</h5> <div class="paragraph"> <p>Another aspect of the 3rd level of intelligence is the fact that it is hash-distribution-aware. This means that, for each operation, the client chooses the most appropriate remote server to go to: the data owner. As an example, for a put(k,v) operation, the client calculates k&#8217;s hash value and knows exactly on which server the data resides on. Then it picks up a tcp connection to that particular server and dispatches the operation to it. This means less burden on the server side which would otherwise need to lookup the value based on the key&#8217;s hash. It also results in a quicker response from the server, as an additional network roundtrip is skipped. This hash-distribution-aware aspect is only relevant to the distributed HotRod clusters and makes no difference for replicated server deployments.</p> </div> </div> </div> <div class="sect3"> <h4 id="_request_balancing"><a class="anchor" href="#_request_balancing"></a>1.6. Request Balancing</h4> <div class="paragraph"> <p>Request balancing is only relevant when the server side is configured with replicated infinispan cluster (on distributed clusters the hash-distribution-aware client logic is used, as discussed in the previos paragraph). Because the client is topology-aware, it knows the list of available servers at all the time. Request balancing has to do with how the client dispatches requests to the available servers.</p> </div> <div class="paragraph"> <p>The default strategy is round-robin: requests are being dispatched to all existing servers in a circular manner. E.g. given a cluster of servers {s1, s2, s3} here is how request will be dispatched:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">CacheContainer cacheContainer = <span class="keyword">new</span> RemoteCacheManager();
Cache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = cacheContainer.getCache();

cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">aValue</span><span class="delimiter">&quot;</span></span>); <span class="comment">//this goes to s1</span>
cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">aValue</span><span class="delimiter">&quot;</span></span>); <span class="comment">//this goes to s2</span>
<span class="predefined-type">String</span> value = cache.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>); <span class="comment">//this goes to s3</span>

cache.remove(<span class="string"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>); <span class="comment">//this is dispatched to s1 again, and so on...</span></code></pre> </div> </div> <div class="paragraph"> <p>Custom types of balancing policies can defined by implementing the <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/impl/transport/tcp/FailoverRequestBalancingStrategy.html">FailoverRequestBalancingStrategy</a> and by specifying it through the infinispan.client.hotrod.request-balancing-strategy configuration property. Please refer to configuration section for more details on this.</p> </div> <div class="paragraph"> <div class="title">WARNING: <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/impl/transport/tcp/FailoverRequestBalancingStrategy.html">FailoverRequestBalancingStrategy</a></div> <p>is a newly added interface in Infinispan 7.0. Previously, users had to provide implementations of <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/impl/transport/tcp/FailoverRequestBalancingStrategy.html">FailoverRequestBalancingStrategy</a> , which it has been deprecated starting with Infinispan 7.0.</p> </div> <div class="sect4"> <h5 id="_persistent_connections"><a class="anchor" href="#_persistent_connections"></a>Persistent connections</h5> <div class="paragraph"> <p>In order to avoid creating a TCP connection on each request (which is a costly operation), the client keeps a pool of persistent connections to all the available servers and it reuses these connections whenever it is possible. The validity of the connections is checked using an async thread that iterates over the connections in the pool and sends a HotRod ping command to the server. By using this connection validation process the client is being proactive: there&#8217;s a hight chance for broken connections to be found while being idle in the pool and no on actual request from the application.</p> </div> <div class="paragraph"> <p>The number of connections per server, total number of connections, how long should a connection be kept idle in the pool before being closed - all these (and more) can be configured. Please refer to the javadoc of <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html">RemoteCacheManager</a> for a list of all possible configuration elements.</p> </div> </div> <div class="sect4"> <h5 id="_marshalling_data"><a class="anchor" href="#_marshalling_data"></a>Marshalling data</h5> <div class="paragraph"> <p>The Hot Rod client allows one to plug in a custom marshaller for transforming user objects into byte arrays and the other way around. This transformation is needed because of Hot Rod&#8217;s binary nature - it doesn&#8217;t know about objects.</p> </div> <div class="paragraph"> <p>The marshaller can be plugged through the "marshaller" configuration element (see Configuration section): the value should be the fully qualified name of a class implementing the <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/marshall/Marshaller.html">Marshaller</a> interface. This is a optional parameter, if not specified it defaults to the <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/marshall/jboss/GenericJBossMarshaller.html">GenericJBossMarshaller</a> - a highly optimized implementation based on the <a href="http://www.jboss.org/jbossmarshalling">JBoss Marshalling</a> library.</p> </div> <div class="paragraph"> <p>Since version 6.0, there&#8217;s a new marshaller available to Java Hot Rod clients based on Protostream which generates portable payloads. You can find more information about it <a href="#_querying_via_the_java_hot_rod_client">here</a></p> </div> </div> <div class="sect4"> <h5 id="_statistics"><a class="anchor" href="#_statistics"></a>Statistics</h5> <div class="paragraph"> <p>Various server usage statistics can be obtained through the <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> .stats() method. This returns a <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/ServerStatistics.html">ServerStatistics</a> object - please refer to javadoc for details on the available statistics.</p> </div> </div> <div class="sect4"> <h5 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>Configuration</h5> <div class="paragraph"> <p>All the configurations are passed to the RemoteCacheManager&#8217;s constructor as key-value pairs, through an instance of <a href="http://docs.oracle.com/javase/6/docs/api/java/util/Properties.html">java.util.Properties</a> or reference to a .properties file. Please refer to the javadoc of RemoteCacheManager for a exhaustive list of the possible configuration elements.</p> </div> </div> <div class="sect4"> <h5 id="_multi_get_operations"><a class="anchor" href="#_multi_get_operations"></a>Multi-Get Operations</h5> <div class="paragraph"> <p>The Java Hot Rod client does not provide multi-get functionality out of the box but clients can build it themselves with the given APIs.</p> </div> </div> <div class="sect4"> <h5 id="_more_info"><a class="anchor" href="#_more_info"></a>More info</h5> <div class="paragraph"> <p>It is highly recommended to read the following Javadocs (this is pretty much all the public API of the client):</p> </div> <div class="ulist"> <ul> <li> <p><a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html">RemoteCacheManager</a></p> </li> <li> <p><a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a></p> </li> </ul> </div> </div> </div> <div class="sect3"> <h4 id="sid-68355052"><a class="anchor" href="#sid-68355052"></a>1.7. Failover capabilities</h4> <div class="paragraph"> <p>Hot Rod clients' capabilities to keep up with topology changes helps with request balancing and more importantly, with the ability to failover operations if one or several of the servers fail.</p> </div> <div class="paragraph"> <p>Some of the conditional operations mentioned above, including <code>putIfAbsent</code>, <code>replace</code> with and without version, and conditional <code>remove</code> have strict method return guarantees, as well as those operations where returning the previous value is forced.</p> </div> <div class="paragraph"> <p>In spite of failures, these methods return values need to be guaranteed, and in order to do so, it&#8217;s necessary that these methods are not applied partially in the cluster in the event of failure. For example, imagine a <code>replace()</code> operation called in a server for key=k1 with <code>Flag.FORCE_RETURN_VALUE</code>, whose current value is <code>A</code> and the replace wants to set it to <code>B</code>. If the replace fails, it could happen that some servers contain <code>B</code> and others contain <code>A</code>, and during the failover, the original <code>replace()</code> could end up returning <code>B</code>, if the replace failovers to a node where <code>B</code> is set, or could end up returning <code>A</code>.</p> </div> <div class="paragraph"> <p>To avoid this kind of situations, whenever Java Hot Rod client users want to use conditional operations, or operations whose previous value is required, it&#8217;s important that the cache is configured to be transactional in order to avoid incorrect conditional operations or return values.</p> </div> <div class="sect4"> <h5 id="_site_cluster_failover"><a class="anchor" href="#_site_cluster_failover"></a>Site Cluster Failover</h5> <div class="paragraph"> <p>On top of the in-cluster failover, Hot Rod clients are also able to failover to different clusters, which could be represented as an independent site.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> This feature was introduced in Infinispan 8.1. </td> </tr> </table> </div> <div class="paragraph"> <p>The way site cluster failover works is that if all the main cluster nodes are not available, the client checks to see if any other clusters have been defined in which cases it tries to failover to the alternative cluster. If the failover succeeds, the client will remain connected to the alternative cluster until this becomes unavailable, in which case it&#8217;ll try any other clusters defined, and ultimately, it&#8217;ll try the original server settings.</p> </div> <div class="paragraph"> <p>To configure a cluster in the Hot Rod client, one host/port pair details must be provided for each of the clusters configured. For example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">org.infinispan.client.hotrod.configuration.ConfigurationBuilder cb
      = <span class="keyword">new</span> org.infinispan.client.hotrod.configuration.ConfigurationBuilder();
cb.addCluster().addClusterNode(<span class="string"><span class="delimiter">&quot;</span><span class="content">remote-cluster-host</span><span class="delimiter">&quot;</span></span>, <span class="integer">11222</span>);
RemoteCacheManager rmc = <span class="keyword">new</span> RemoteCacheManager(cb.build());</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> Remember that regardless of the cluster definitions, the initial server(s) configuration must be provided unless the initial servers can be resolved using the default server host and port details. </td> </tr> </table> </div> <div class="sect5"> <h6 id="_manual_site_cluster_switch"><a class="anchor" href="#_manual_site_cluster_switch"></a>Manual Site Cluster Switch</h6> <div class="paragraph"> <p>As well as supporting automatic site cluster failover, Java Hot Rod clients can also switch between site clusters manually by calling RemoteCacheManager&#8217;s <code>switchToCluster(clusterName)</code> and <code>switchToDefaultCluster()</code>.</p> </div> <div class="paragraph"> <p>Using <code>switchToCluster(clusterName)</code>, users can force a client to switch to one of the clusters pre-defined in the Hot Rod client configuration. To switch to the initial servers defined in the client configuration, call <code>switchToDefaultCluster()</code>.</p> </div> </div> </div> </div> <div class="sect3"> <h4 id="_consistent_concurrent_updates_with_hot_rod_versioned_operations"><a class="anchor" href="#_consistent_concurrent_updates_with_hot_rod_versioned_operations"></a>1.8. Consistent Concurrent Updates With Hot Rod Versioned Operations</h4> <div class="paragraph"> <p>Data structures, such as Infinispan <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/Cache.html">Cache</a> , that are accessed and modified concurrently can suffer from data consistency issues unless there&#8217;re mechanisms to guarantee data correctness. Infinispan Cache, since it implements <a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentMap.html">ConcurrentMap</a> , provides operations such as link:http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentMap.html#replace(K, V, V)[conditional replace] , link:http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentMap.html#putIfAbsent(K, V)[putIfAbsent] , and link:http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentMap.html#remove(java.lang.Object, java.lang.Object)[conditional remove] to its clients in order to guarantee data correctness. It even allows clients to operate against cache instances within JTA transactions, hence providing the necessary data consistency guarantees.</p> </div> <div class="paragraph"> <p>However, when it comes to <a href="http://community.jboss.org/wiki/HotRodProtocol">Hot Rod protocol</a> backed servers, clients do not yet have the ability to start remote transactions but they can call instead versioned operations to mimic the conditional methods provided by the embedded Infinispan cache instance API. Let&#8217;s look at a real example to understand how it works.</p> </div> <div class="sect4"> <h5 id="_data_consistency_problem"><a class="anchor" href="#_data_consistency_problem"></a>Data Consistency Problem</h5> <div class="paragraph"> <p>Imagine you have two ATMs that connect using Hot Rod to a bank where an account&#8217;s balance is stored. Two closely followed operations to retrieve the latest balance could return 500 CHF (swiss francs) as shown below:</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_6.png" alt="server modules 6"> </div> </div> <div class="paragraph"> <p>Next a customer connects to the first ATM and requests 400 CHF to be retrieved. Based on the last value read, the ATM could calculate what the new balance is, which is 100 CHF, and request a put with this new value. Let&#8217;s imagine now that around the same time another customer connects to the ATM and requests 200 CHF to be retrieved. Let&#8217;s assume that the ATM thinks it has the latest balance and based on its calculations it sets the new balance to 300 CHF:</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_7.png" alt="server modules 7"> </div> </div> <div class="paragraph"> <p>Obviously, this would be wrong. Two concurrent updates have resulted in an incorrect account balance. The second update should not have been allowed since the balance the second ATM had was incorrect. Even if the ATM would have retrieved the balance before calculating the new balance, someone could have updated between the new balance being retrieved and the update. Before finding out how to solve this issue in a client-server scenario with Hot Rod, let&#8217;s look at how this is solved when Infinispan clients run in peer-to-peer mode where clients and Infinispan live within the same JVM.</p> </div> <div class="sect5"> <h6 id="_embedded_mode_solution"><a class="anchor" href="#_embedded_mode_solution"></a>Embedded-mode Solution</h6> <div class="paragraph"> <p>If the ATM and the Infinispan instance storing the bank account lived in the same JVM, the ATM could use the link:http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentMap.html#replace(K, V, V)[conditional replace API] referred at the beginning of this article. So, it could send the previous known value to verify whether it has changed since it was last read. By doing so, the first operation could double check that the balance is still 500 CHF when it was to update to 100 CHF. Now, when the second operation comes, the current balance would not be 500 CHF any more and hence the conditional replace call would fail, hence avoiding data consistency issues:</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_8.png" alt="server modules 8"> </div> </div> </div> <div class="sect5"> <h6 id="_client_server_solution"><a class="anchor" href="#_client_server_solution"></a>Client-Server Solution</h6> <div class="paragraph"> <p>In theory, Hot Rod could use the same p2p solution but sending the previous value would be not practical. In this example, the previous value is just an integer but the value could be a lot bigger and hence forcing clients to send it to the server would be rather wasteful. Instead, Hot Rod offers versioned operations to deal with this situation.</p> </div> <div class="paragraph"> <p>Basically, together with each key/value pair, Hot Rod stores a version number which uniquely identifies each modification. So, using an operation called <a href="http://community.jboss.org/wiki/HotRodProtocol#getWithVersion_response">getVersioned or getWithVersion</a> , clients can retrieve not only the value associated with a key, but also the current version. So, if we look at the previous example once again, the ATMs could call getVersioned and get the balance&#8217;s version:</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_9.png" alt="server modules 9"> </div> </div> <div class="paragraph"> <p>When the ATMs wanted to modify the balance, instead of just calling put, they could call <a href="http://community.jboss.org/wiki/HotRodProtocol#removeIfUnmodified_request">replaceIfUnmodified</a> operation passing the latest version number of which the clients are aware of. The operation will only succeed if the version passed matches the version in the server. So, the first modification by the ATM would be allowed since the client passes 1 as version and the server side version for the balance is also 1. On the other hand, the second ATM would not be able to make the modification because after the first ATMs modification the version would have been incremented to 2, and now the passed version (1) and the server side version (2) would not match:</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_10.png" alt="server modules 10"> </div> </div> </div> </div> </div> <div class="sect3"> <h4 id="sid-68355104"><a class="anchor" href="#sid-68355104"></a>1.9. Interacting With Hot Rod Server From Within Same JVM</h4> <div class="paragraph"> <p>Normally, a Hot Rod server is accessed via a Hot Rod protocol client such as the Java Hot Rod client. However, there might be situations where not only do you want to access the Hot Rod server remotely, you might also want to access it locally from within the same JVM that the Hot Rod server is running. For example, you might have an Infinispan cache pushing changes <a href="#_remote_cache_loader">via the RemoteCacheStore to a Hot Rod server</a>, and if the cache goes down, you might want to access the data directly from the Hot Rod server itself.</p> </div> <div class="paragraph"> <p>In this situations, we have to remember that the Hot Rod protocol specifies that keys and values are stored as byte arrays. This means that if the client code, using an existing Hot Rod client, stored Strings or Integers, or any other complex serializable or externalizable object, you won&#8217;t be able to retrieve these objects straight from the cache that the Hot Rod server uses.</p> </div> <div class="paragraph"> <p>To actually get the fully constructed objects that you&#8217;re after, you&#8217;re gonna need to take the byte arrays stored within the Hot Rod server and unmarshall them into something that you can use. In the future, this is something that might be done for you, as suggested in <a href="https://jira.jboss.org/browse/ISPN-706">ISPN-706</a> (superseded by <a href="https://issues.jboss.org/browse/ISPN-2281">ISPN-2281</a> ), but for the time being, clients wanting to access Hot Rod server data will have to do it themselves.</p> </div> <div class="paragraph"> <p>Two different use cases need to be differentiated at this stage and to explain how to transform the Hot Rod server data into something usable, we&#8217;ll assume that the clients are java clients:</p> </div> <div class="sect4"> <h5 id="_data_stored_directly_via_a_hot_rod_client"><a class="anchor" href="#_data_stored_directly_via_a_hot_rod_client"></a>Data Stored Directly Via A Hot Rod Client</h5> <div class="paragraph"> <p>The most common case is for a client to use a Hot Rod client library directly to store data in the Hot Rod server. In this case, assuming that the client used the existing Java Hot Rod client, the default marshaller used to marshall objects into byte arrays is the <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/marshall/jboss/GenericJBossMarshaller.html">GenericJBossMarshaller</a> . So, if a user wants to read data from the Hot Rod server directly, it would need to execute something along the lines of:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.marshall.jboss.GenericJBossMarshaller</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.util.ByteArrayKey</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.server.core.CacheValue</span>;
...

<span class="comment">// Create a new instance of the marshaller:</span>
GenericJBossMarshaller marshaller = <span class="keyword">new</span> GenericJBossMarshaller();
<span class="predefined-type">Object</span> key = ...

<span class="comment">// Take the cache key and convert into a byte array,</span>
<span class="comment">// and wrap it with an instance of ByteArrayKey</span>
ByteArrayKey bytesKey = <span class="keyword">new</span> ByteArrayKey(marshaller.objectToByteBuffer(key));

<span class="comment">// Internally, Hot Rod stores values wrapped in a CacheValue, so retrieve it</span>
CacheValue cacheValue = (CacheValue) cache.get(bytesKey);

<span class="comment">// Take the data part which is byte array and unmarshall it to retrieve the value</span>
<span class="predefined-type">Object</span> value = marshaller.objectFromByteBuffer(cacheValue.data());</code></pre> </div> </div> <div class="paragraph"> <p>If you want to store data directly in the HotRod server, you&#8217;d have to execute something like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.marshall.jboss.GenericJBossMarshaller</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.util.ByteArrayKey</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.server.core.CacheValue</span>;
...

<span class="comment">// Create a new instance of the marshaller:</span>
GenericJBossMarshaller marshaller = <span class="keyword">new</span> GenericJBossMarshaller();
<span class="predefined-type">Object</span> key = ...
Object value = ...

<span class="comment">// Take the cache key and convert into a byte array,</span>
<span class="comment">// and wrap it with an instance of ByteArrayKey</span>
ByteArrayKey bytesKey = <span class="keyword">new</span> ByteArrayKey(marshaller.objectToByteBuffer(key));

<span class="comment">// Internally, Hot Rod stores values wrapped in a CacheValue, so create instance</span>
<span class="comment">// Remember that you need to give it a version number, so either:</span>
<span class="comment">// 1. Increment previous value's version</span>
<span class="comment">// 2. Or generate a new version number that minimises potential clash</span>
<span class="comment">//    with a concurrent update to the same key in the cluster</span>
CacheValue cacheValue = <span class="keyword">new</span> CacheValue(marshaller.objectToByteBuffer(value), <span class="integer">1</span>)

<span class="comment">// Finally, store it in the cache</span>
cache.put(bytesKey, cacheValue);</code></pre> </div> </div> </div> <div class="sect4"> <h5 id="_data_stored_via_remote_cache_store"><a class="anchor" href="#_data_stored_via_remote_cache_store"></a>Data Stored Via Remote Cache Store</h5> <div class="paragraph"> <p>Other times, Hot Rod server might be storing data coming from a <a href="https://docs.jboss.org/author/pages/viewpage.action?pageId=3737163">RemoteCacheStore</a> , rather than user code. In this case, there&#8217;re a couple of differences to the code above. First of all, the marshaller is slightly different. Instead, the RemoteCacheStore uses the <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/marshall/VersionAwareMarshaller.html">VersionAwareMarshaller</a> which all it does is add Infinispan version information to the byte array generated. The second difference is that RemoteCacheStore stores internal cache entry classes, which apart from the value part, they contain other extra information. So, any code trying to read these directly from the Hot Rod server would need to take in account. For example, to read data from such Hot Rod server:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.marshall.VersionAwareMarshaller</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.util.ByteArrayKey</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.server.core.CacheValue</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.container.entries.CacheEntry</span>;
...

<span class="comment">// Create a new instance of the marshaller</span>
VersionAwareMarshaller marshaller = <span class="keyword">new</span> VersionAwareMarshaller();
<span class="predefined-type">Object</span> key = ...

<span class="comment">// Take the cache key and convert into a byte array,</span>
<span class="comment">// and wrap it with an instance of ByteArrayKey</span>
ByteArrayKey bytesKey = <span class="keyword">new</span> ByteArrayKey(marshaller.objectToByteBuffer(key));

<span class="comment">// Internally, Hot Rod stores values wrapped in a CacheValue, so retrieve it</span>
CacheValue cacheValue = (CacheValue) cache.get(bytesKey);

<span class="comment">// However, in this case the data part of CacheValue does not contain directly</span>
<span class="comment">// the value Instead, it contains an instance of CacheEntry, so we need to</span>
<span class="comment">// unmarshall that and then get the actual value</span>
CacheEntry cacheEntry = (CacheEntry)
<span class="error"> </span><span class="error"> </span> marshaller.objectFromByteBuffer(cacheValue.data());
<span class="predefined-type">Object</span> value = cacheEntry.getValue();</code></pre> </div> </div> <div class="paragraph"> <p>And to actually write data back into the Hot Rod server directly:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.marshall.VersionAwareMarshaller</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.util.ByteArrayKey</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.server.core.CacheValue</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.container.entries.CacheEntry</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.container.entries.InternalEntryFactory</span>;
...

<span class="comment">// Create a new instance of the marshaller:</span>
VersionAwareMarshaller marshaller = <span class="keyword">new</span> VersionAwareMarshaller();
<span class="predefined-type">Object</span> key = ...
Object value = ...

<span class="comment">// Take the cache key and convert into a byte array</span>
ByteArrayKey bytesKey = <span class="keyword">new</span> ByteArrayKey(marshaller.objectToByteBuffer(key));

<span class="comment">// With the value to store, a new CacheEntry instance needs to be created:</span>
CacheEntry cacheEntry = InternalEntryFactory.create(bytesKey, value, ...)

<span class="comment">// Internally, Hot Rod stores values wrapped in a CacheValue, so create instance</span>
<span class="comment">// Remember that you need to give it a version number, so either:</span>
<span class="comment">// 1. Increment previous value's version</span>
<span class="comment">// 2. Or generate a new version number that minimises potential clash</span>
<span class="comment">//    with a concurrent update to the same key in the cluster</span>
CacheValue cacheValue = <span class="keyword">new</span> CacheValue(
<span class="error"> </span><span class="error"> </span> marshaller.objectToByteBuffer(cacheEntry), <span class="integer">1</span>)

<span class="comment">// Finally, store it in the cache</span>
cache.put(bytesKey, cacheValue);</code></pre> </div> </div> </div> <div class="sect4"> <h5 id="_multiple_tiers_of_caches"><a class="anchor" href="#_multiple_tiers_of_caches"></a>Multiple Tiers of Caches</h5> <div class="paragraph"> <p>A combination of the Hot Rod protocol and <a href="http://community.jboss.org/docs/DOC-14893?uniqueTitle=false#Remote_cache_loader">RemoteCacheLoader</a> opened the way for a set of new architectures in Infinispan, where layers of caches can exists and interact. This article takes a look at such a layered architecture.</p> </div> <div class="sect5"> <h6 id="_sample_architecture_near_caching"><a class="anchor" href="#_sample_architecture_near_caching"></a>Sample architecture/near caching</h6> <div class="imageblock"> <div class="content"> <img src="images/client_server.png" alt="client server"> </div> </div> <div class="paragraph"> <p>The diagram above shows an Infinispan server cluster running 3 hotrod servers. This cluster is accessed remotely, through HotRod, by another infinispan cluster:  client cluster (upper part of the image). All the nodes in the server cluster are configured to run HotRod servers, so requests from remote loader are being balanced between them. The client cluster is configured with invalidation as cluster mode and a RemoteCacheLoader to access data stored in the server cluster. Application data is held on the server cluster which runs in DIST mode for scalability.</p> </div> <div class="paragraph"> <p>In this deployment the client code, running in same address space with the client cluster,  holds all its data in the server cluster. Client cluster acts as an <em>near-cache</em> for frequently accessed entries.</p> </div> </div> </div> </div> <div class="sect3"> <h4 id="_querying_via_the_java_hot_rod_client"><a class="anchor" href="#_querying_via_the_java_hot_rod_client"></a>1.10. Querying via the Java Hot Rod client</h4> <div class="paragraph"> <p>While previous Infinispan versions were already providing <a href="#_querying_infinispan">indexing and searching</a> of Java entities to embedded clients, starting with Infinispan 6.0 and the introduction of the new <a href="#_hot_rod_protocol_1_3">Hot Rod protocol version 1.3</a> we add support for remote, language neutral, querying.</p> </div> <div class="paragraph"> <p>This leap required two major changes:</p> </div> <div class="ulist"> <ul> <li> <p>Since non-JVM clients cannot benefit from directly using <a href="http://lucene.apache.org/">Apache Lucene</a>'s Java API, Infinispan defines its own new <a href="#_infinispan_s_query_dsl">query language</a>, based on an internal DSL that is easily implementable in all languages for which we currently have an implementation of the Hot Rod client.</p> </li> <li> <p>In order to enable indexing, the entities put in the cache by clients can no longer be opaque binary blobs understood solely by the client. Their structure has to be known to both server and client, so a common way of encoding structured data had to be adopted. Furthermore, allowing multi-language clients to access the data requires a language and platform-neutral encoding. Google&#8217;s <a href="http://code.google.com/p/protobuf/">Protocol Buffers</a> was elected as an encoding format for both over-the-wire and storage due to its efficiency, robustness, good multi-language support and support for schema evolution.</p> </li> </ul> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> As of 6.0, only the Java implementation of the Hot Rod client was upgraded to support querying. Clients for other languages will follow soon. </td> </tr> </table> </div> <div class="sect4"> <h5 id="_storing_protobuf_encoded_entities"><a class="anchor" href="#_storing_protobuf_encoded_entities"></a>Storing Protobuf encoded entities</h5> <div class="paragraph"> <p>Remote clients that want to be able to index and query their stored entities must do so using the Protobuf encoding format. This is <em>key</em> for the search capability to work. But it&#8217;s also possible to store Protobuf entities just for gaining the benefit of platform independence and not enable indexing if you do not need it.</p> </div> <div class="paragraph"> <p>Protobuf is all about structured data, so first thing you do to use it is define the structure of your data. This is accomplished by declaring protocol buffer message types in .proto files, like in the following example. Protobuf is a broad subject, we will not detail it here, so please consult the Protobuf <a href="https://developers.google.com/protocol-buffers/docs/overview">Developer Guide</a> for an in-depth explanation. It suffices to say for now that our example defines an entity (message type in protobuf speak) named <em>Book</em>, placed in a package named <em>book_sample</em>. Our entity declares several fields of primitive types and a repeatable field (an array basically) named <em>authors</em>. The <em>Author</em> message instances are embedded in the <em>Book</em> message instance.</p> </div> <div class="listingblock"> <div class="title">library.proto</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="proto">package book_sample;

message Book {
  required string title = 1;
  required string description = 2;
  required int32 publicationYear = 3; // no native Date type available in Protobuf

  repeated Author authors = 4;
}

message Author {
  required string name = 1;
  required string surname = 2;
}</code></pre> </div> </div> <div class="paragraph"> <p>There are a few important notes we need to make about Protobuf messages:</p> </div> <div class="ulist"> <ul> <li> <p>nesting of messages is possible, but the resulting structure is strictly a tree, never a graph</p> </li> <li> <p>there is no concept of type inheritance</p> </li> <li> <p>collections are not supported but arrays can be easily emulated using repeated fields</p> </li> </ul> </div> <div class="paragraph"> <p>Using Protobuf with the Java Hot Rod client is a two step process. First, the client must be configured to use a dedicated marshaller, <a href="http://docs.jboss.org/infinispan/9.0/apidocs/org/infinispan/client/hotrod/marshall/ProtoStreamMarshaller.html"><em>ProtoStreamMarshaller</em></a>. This marshaller uses the <a href="https://github.com/infinispan/protostream"><em>ProtoStream</em></a> library to assist you in encoding your objects. The second step is instructing <em>ProtoStream</em> library on how to marshall your message types. The following example highlights this process.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td> <td class="code"><pre><span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.configuration.ConfigurationBuilder</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.marshall.ProtoStreamMarshaller</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.protostream.SerializationContext</span>;
...

ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder.addServer()
    .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>).port(<span class="integer">11234</span>)
    .marshaller(<span class="keyword">new</span> ProtoStreamMarshaller());

RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());

SerializationContext srcCtx = ProtoStreamMarshaller.getSerializationContext(remoteCacheManager);

serCtx.registerProtofiles(<span class="string"><span class="delimiter">&quot;</span><span class="content">/library.proto</span><span class="delimiter">&quot;</span></span>);
serCtx.registerMarshaller(<span class="predefined-type">Book</span>.class, <span class="keyword">new</span> BookMarshaller());
serCtx.registerMarshaller(Author.class, <span class="keyword">new</span> AuthorMarshaller());

<span class="comment">// Book and Author classes omitted for brevity</span></pre></td> </tr></table></code></pre> </div> </div> <div class="paragraph"> <p>The interesting part in this sample is obtaining the <em>SerializationContext</em> associated to the <em>RemoteCacheManager</em> and then instructing ProtoStream about the protobuf types we want to marshall. The <em>SerializationContext</em> is provided by the library for this purpose. The <code>SerializationContext.registerProtoFiles</code> method receives the name of one or more classpath resources that is expected to be a protobuf definition containing our type declarations.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="fa icon-note" title="Note"></i> </td> <td class="content"> A <em>RemoteCacheManager</em> has no <em>SerializationContext</em> associated with it unless it was configured to use a <em>ProtoStreamMarshaller</em>. </td> </tr> </table> </div> <div class="paragraph"> <p>The next relevant part is the registration of per entity marshallers for our domain model types. They must be provided by the user for each type or marshalling will fail. Writing marshallers is a simple process. The <em>BookMarshaller</em> example should get you started. The most important thing you need to consider is they need to be stateless and threadsafe as a single instance of them is being used.</p> </div> <div class="listingblock"> <div class="title">BookMarshaller.java</div> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.protostream.MessageMarshaller</span>;
...

public <span class="type">class</span> <span class="class">BookMarshaller</span> <span class="directive">implements</span> MessageMarshaller&lt;<span class="predefined-type">Book</span>&gt; {

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> getTypeName() {
      <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">book_sample.Book</span><span class="delimiter">&quot;</span></span>;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> <span class="predefined-type">Book</span>&gt; getJavaClass() {
      <span class="keyword">return</span> <span class="predefined-type">Book</span>.class;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> writeTo(ProtoStreamWriter writer, <span class="predefined-type">Book</span> book) <span class="directive">throws</span> <span class="exception">IOException</span> {
      writer.writeString(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, book.getTitle());
      writer.writeString(<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>, book.getDescription());
      writer.writeCollection(<span class="string"><span class="delimiter">&quot;</span><span class="content">authors</span><span class="delimiter">&quot;</span></span>, book.getAuthors(), Author.class);
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">Book</span> readFrom(ProtoStreamReader reader) <span class="directive">throws</span> <span class="exception">IOException</span> {
      <span class="predefined-type">String</span> title = reader.readString(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>);
      <span class="predefined-type">String</span> description = reader.readString(<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>);
      <span class="type">int</span> publicationYear = reader.readInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">publicationYear</span><span class="delimiter">&quot;</span></span>);
      <span class="predefined-type">Set</span>&lt;Author&gt; authors = reader.readCollection(<span class="string"><span class="delimiter">&quot;</span><span class="content">authors</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;Author&gt;(), Author.class);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">Book</span>(title, description, publicationYear, authors);
   }
}</code></pre> </div> </div> <div class="paragraph"> <p>Once you&#8217;ve followed these steps to setup your client you can start reading and writing Java objects to the remote cache and the actual data stored in the cache will be protobuf encoded provided that marshallers were registered with the remote client for all involved types (<em>Book</em> and <em>Author</em> in our example). Keeping your objects stored in protobuf format has the benefit of being able to consume them with compatible clients written in different languages.</p> </div> <div class="paragraph"> <p>TODO Add reference to sample in C++ client user guide</p> </div> </div> <div class="sect4"> <h5 id="_indexing_of_protobuf_encoded_entries"><a class="anchor" href="#_indexing_of_protobuf_encoded_entries"></a>Indexing of Protobuf encoded entries</h5> <div class="paragraph"> <p>After configuring the client as described in the previous section you can start configuring indexing for your caches on the server side. Activating indexing and the various indexing specific configurations is identical to embedded mode and is detailed in the <a href="#_configuration_7">Querying Infinispan</a> chapter.</p> </div> <div class="paragraph"> <p>There is however an extra configuration step involved. While in embedded mode the indexing metadata is obtained via Java reflection by analyzing the presence of various Hibernate Search annotations on the entry&#8217;s class, this is obviously not possible if the entry is protobuf encoded. The server needs to extract the relevant metadata from the same descriptor (.proto file) as the client. The descriptors are stored in a dedicated cache on the server <em>'<em>_protobuf_metadata'</em>. Registering a new schema is therefore as simple as performing a <em>put</em> operation on that cache using the schema&#8217;s name as a key and the schema itself as the value. Alternatively you can use the CLI (via the cache-container=*:register-proto-schemas() operation), the Console or the <em>ProtobufMetadataManager</em> MBean via JMX. Be aware that, when security is enabled, access to the schema cache via the remote protocols requires that the user belongs to the <em>'</em>_schema_manager role'</em> NOTE: Once indexing is enabled for a cache all fields of Protobuf encoded entries are going to be indexed. Future versions will allow you to select which fields to index (see <a href="https://issues.jboss.org/browse/ISPN-3718">ISPN-3718</a>).</p> </div> </div> <div class="sect4"> <h5 id="_a_remote_query_example"><a class="anchor" href="#_a_remote_query_example"></a>A remote query example</h5> <div class="paragraph"> <p>You&#8217;ve managed to configure both client and server to talk protobuf and you&#8217;ve enabled indexing. Let&#8217;s put some data in the cache and try to search for it then!</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.query.dsl</span>.*;
...

RemoteCacheManager remoteCacheManager = ...;
RemoteCache&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Book</span>&gt; remoteCache = remoteCacheManager.getCache();

<span class="predefined-type">Book</span> book1 = <span class="keyword">new</span> <span class="predefined-type">Book</span>();
book1.setTitle(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hibernate in Action</span><span class="delimiter">&quot;</span></span>);
remoteCache.put(<span class="integer">1</span>, book1);

<span class="predefined-type">Book</span> book2 = <span class="keyword">new</span> <span class="predefined-type">Book</span>();
book2.setTile(<span class="string"><span class="delimiter">&quot;</span><span class="content">Infinispan Data Grid Platform</span><span class="delimiter">&quot;</span></span>);
remoteCache.put(<span class="integer">2</span>, book2);

QueryFactory qf = Search.getQueryFactory(remoteCache);
<span class="predefined-type">Query</span> query = qf.from(<span class="predefined-type">Book</span>.class)
            .having(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Infinispan%</span><span class="delimiter">&quot;</span></span>).toBuilder()
            .build();

<span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; list = query.list(); <span class="comment">// Voila! We have our book back from the cache!</span></code></pre> </div> </div> <div class="paragraph"> <p>The key part of creating a query is obtaining the <em>QueryFactory</em> for the remote cache using the <em>org.infinispan.client.hotrod.Search.getQueryFactory()</em> method. Once you have this creating the query is similar to embedded mode which is covered in <a href="#_infinispan_s_query_dsl">this</a> section.</p> </div> </div> <div class="sect4"> <h5 id="_running_in_compatibility_mode"><a class="anchor" href="#_running_in_compatibility_mode"></a>Running in Compatibility Mode</h5> <div class="paragraph"> <p>TODO</p> </div> </div> </div> </div> <div class="sect2"> <h3 id="_scripting"><a class="anchor" href="#_scripting"></a>2. Scripting</h3> <div class="paragraph"> <p>Scripting is a feature of Infinispan Server which allows invoking server-side scripts from remote clients. Scripting leverages the JDK&#8217;s javax.script ScriptEngines, therefore allowing the use of any JVM languages which offer one. By default, the JDK comes with Nashorn, a ScriptEngine capable of running JavaScript.</p> </div> <div class="sect3"> <h4 id="_installing_scripts"><a class="anchor" href="#_installing_scripts"></a>2.1. Installing scripts</h4> <div class="paragraph"> <p>Scripts are stored in a special script cache, named '<em><em>script_cache'. Adding a script is therefore as simple as put+ting it into the cache itself. If the name of the script contains a filename extension, e.g. +myscript.js, then that extension determines the engine that will be used to execute it. Alternatively the script engine can be selected using script metadata (see below). Be aware that, when security is enabled, access to the script cache via the remote protocols requires that the user belongs to the _'</em>_script_manager role'</em>.</p> </div> </div> <div class="sect3"> <h4 id="_script_metadata"><a class="anchor" href="#_script_metadata"></a>2.2. Script metadata</h4> <div class="paragraph"> <p>Script metadata is additional information about the script that the user can provide to the server to affect how a script is executed. It is contained in a specially-formatted comment on the first lines of the script.</p> </div> <div class="paragraph"> <p>Properties are specified as key=value pairs, separated by commas. You can use several different comment styles: The <code>//</code>, <code>;;</code>, <code>#</code> depending on the scripting language you use. You can split metadata over multiple lines if necessary, and you can use single (') or double (") quotes to delimit your values.</p> </div> <div class="paragraph"> <p>The following are examples of valid metadata comments:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// name=test, language=javascript</span>
<span class="comment">// mode=local, parameters=[a,b,c]</span></code></pre> </div> </div> <div class="sect4"> <h5 id="_metadata_properties"><a class="anchor" href="#_metadata_properties"></a>Metadata properties</h5> <div class="paragraph"> <p>The following metadata property keys are available</p> </div> <div class="ulist"> <ul> <li> <p>mode: defines the mode of execution of a script. Can be one of the following values:</p> <div class="ulist"> <ul> <li> <p>local: the script will be executed only by the node handling the request. The script itself however can invoke clustered operations</p> </li> <li> <p>distributed: runs the script using the Distributed Executor Service</p> </li> </ul> </div> </li> <li> <p>language: defines the script engine that will be used to execute the script, e.g. Javascript</p> </li> <li> <p>extension: an alternative method of specifying the script engine that will be used to execute the script, e.g. js</p> </li> <li> <p>role: a specific role which is required to execute the script</p> </li> <li> <p>parameters: an array of valid parameter names for this script. Invocations which specify parameter names not included in this list will cause an exception.</p> </li> <li> <p>datatype: optional property providing information, in the form of Media Types (also known as MIME) about the type of the data stored in the caches, as well as parameter and return values. Currently it only accepts a single value which is <code>text/plain; charset=utf-8</code>, indicating that data is String UTF-8 format. This metadata parameter is designed for remote clients that only support a particular type of data, making it easy for them to retrieve, store and work with parameters.</p> </li> </ul> </div> <div class="paragraph"> <p>Since the execution mode is a characteristic of the script, nothing special needs to be done on the client to invoke scripts in different modes.</p> </div> </div> </div> <div class="sect3"> <h4 id="_script_bindings"><a class="anchor" href="#_script_bindings"></a>2.3. Script bindings</h4> <div class="paragraph"> <p>The script engine within Infinispan exposes several internal objects as bindings in the scope of the script execution. These are:</p> </div> <div class="ulist"> <ul> <li> <p>cache: the cache against which the script is being executed</p> </li> <li> <p>marshaller: the marshaller to use for marshalling/unmarshalling data to the cache</p> </li> <li> <p>cacheManager: the cacheManager for the cache</p> </li> <li> <p>scriptingManager: the instance of the script manager which is being used to run the script. This can be used to run other scripts from a script.</p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="_script_parameters"><a class="anchor" href="#_script_parameters"></a>2.4. Script parameters</h4> <div class="paragraph"> <p>Aside from the standard bindings described above, when a script is executed it can be passed a set of named parameters which also appear as bindings. Parameters are passed as name,value pairs where name is a string and value can be any value that is understood by the marshaller in use.</p> </div> <div class="paragraph"> <p>The following is an example of a JavaScript script which takes two parameters, multiplicand and multiplier and multiplies them. Because the last operation is an expression evaluation, its result is returned to the invoker.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// mode=local,language=javascript</span>
multiplicand * multiplier</code></pre> </div> </div> <div class="paragraph"> <p>To store the script in the script cache, use the following Hot Rod code:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; scriptCache = cacheManager.getCache(<span class="string"><span class="delimiter">&quot;</span><span class="content">___script_cache</span><span class="delimiter">&quot;</span></span>);
scriptCache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplication.js</span><span class="delimiter">&quot;</span></span>,
  <span class="string"><span class="delimiter">&quot;</span><span class="content">// mode=local,language=javascript</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
  <span class="string"><span class="delimiter">&quot;</span><span class="content">multiplicand * multiplier</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>);</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="_running_scripts_using_the_hot_rod_java_client"><a class="anchor" href="#_running_scripts_using_the_hot_rod_java_client"></a>2.5. Running Scripts using the Hot Rod Java client</h4> <div class="paragraph"> <p>The following example shows how to invoke the above script by passing two named parameters.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="java">RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; cache = cacheManager.getCache();
<span class="comment">// Create the parameters for script execution</span>
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplicand</span><span class="delimiter">&quot;</span></span>, <span class="integer">10</span>);
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplier</span><span class="delimiter">&quot;</span></span>, <span class="integer">20</span>);
<span class="comment">// Run the script on the server, passing in the parameters</span>
<span class="predefined-type">Object</span> result = cache.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">multiplication.js</span><span class="delimiter">&quot;</span></span>, params);</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="_distributed_execution"><a class="anchor" href="#_distributed_execution"></a>2.6. Distributed execution</h4> <div class="paragraph"> <p>The following is a script which runs within a Distributed Executor. Each node will return its address, and the results from all nodes will be collected in a List and returned to the client.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay highlight"><code data-lang="javascript"><span class="comment">// mode:distributed,language=javascript</span>
cacheManager.getAddress().toString();</code></pre> </div> </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2016-05-26 18:06:12 CEST </div> </div> </body> </html>